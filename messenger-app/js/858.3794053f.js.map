{"version":3,"file":"js/858.3794053f.js","mappings":"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","sources":["webpack://messenger-app/./src/utils/imageUpload.ts","webpack://messenger-app/./src/views/auth/ProfileEditPage.vue?c741","webpack://messenger-app/./src/components/UI/Auth/ProfileEdit.vue","webpack://messenger-app/./src/components/UI/Auth/ProfileEdit.vue?00ff","webpack://messenger-app/./src/views/auth/ProfileEditPage.vue?1366","webpack://messenger-app/./src/views/auth/ProfileEditPage.vue"],"sourcesContent":["import { uploadBytes, ref, getDownloadURL, StorageReference } from \"firebase/storage\"\r\nimport { storage } from \"@/firebase/config\";\r\nfunction getImageRatio(HTMLImage: HTMLImageElement, containerPixelWidth: number) {\r\n    console.log(containerPixelWidth / HTMLImage.naturalWidth)\r\n    return containerPixelWidth / HTMLImage.naturalWidth\r\n}\r\nasync function onImagePaste(e): Promise<dataURL | null>{\r\n    const item = (e.clipboardData || e.originalEvent.clipboardData).items[0];\r\n    console.log((e.clipboardData || e.originalEvent.clipboardData).items)\r\n    if (item.kind === 'file') {\r\n            const blob = item.getAsFile();\r\n            return await getDataURL(blob, 1, 800, 800)\r\n        }\r\n        return null\r\n    }\r\n    function changeImageSize(imageElement:HTMLImageElement, width: number, height?: number): string {\r\n        const canvas: HTMLCanvasElement = document.createElement('canvas'),\r\n            ctx = canvas.getContext('2d') as CanvasRenderingContext2D\r\n            canvas.width = width\r\n        if(!height) canvas.height = imageElement.height * getImageRatio(imageElement, width)\r\n        else canvas.height = height\r\n        ctx.drawImage(imageElement, 0, 0, canvas.width, canvas.height)\r\n        return ctx.canvas.toDataURL('image/jpeg')\r\n        \r\n    }\r\n    function getDataURL(inputImage: Blob, compress: number, width: number, maxHeight?: number, height?: number,): Promise<dataURL> {\r\n    return new Promise(resolve => {\r\n        const reader = new FileReader()\r\n        reader.readAsDataURL(inputImage)\r\n        reader.onload = function (this: FileReader, event: ProgressEvent<FileReader>): void {\r\n            const imageDataUrl = (event.target as FileReader).result as string\r\n            const imageElement: HTMLImageElement = document.createElement('img')\r\n            imageElement.src = imageDataUrl\r\n            imageElement.onload = function (this: GlobalEventHandlers, e: Event) {\r\n                \r\n                const width_ratio = width / (e.target as HTMLImageElement).width,\r\n                canvas: HTMLCanvasElement = document.createElement('canvas'),\r\n                ctx = canvas.getContext('2d') as CanvasRenderingContext2D\r\n                canvas.width = width\r\n                if(!height) canvas.height = (e.target as HTMLCanvasElement).height\r\n                else canvas.height = height\r\n                \r\n                \r\n                canvas.height *= width_ratio\r\n                \r\n                \r\n                ctx.drawImage(imageElement, 0, 0, canvas.width, canvas.height)\r\n                const newImageDataUrl = ctx.canvas.toDataURL('image/jpeg', compress)\r\n                resolve({\r\n                    dataUrl: newImageDataUrl,\r\n                    additionalData: newImageDataUrl.split(',')[0],\r\n                    coded: newImageDataUrl.split(',')[1]\r\n                })            \r\n            }            \r\n        }\r\n    })   \r\n}\r\nasync function URLtoFile(url: string): Promise<File | null>{\r\n    try {\r\n        if(url.includes('firebasestorage')) return null\r\n        const blobbed_response: Blob = await (await fetch(url))?.blob(),\r\n        file = new File([blobbed_response], 'File', {type: blobbed_response.type})\r\n        return file\r\n    }\r\n    catch(e) {\r\n        console.warn(\"Failed to fetch an image URL, this may be a CORS\")\r\n        throw(e)\r\n    }\r\n}\r\nasync function getGeneratedAvatar(q = ''): Promise<string> {\r\n    if(!q) {\r\n        for(let i = 0; i < 6; i++) {\r\n            q += Math.floor(Math.random() * 47).toString()\r\n        }\r\n    }\r\n    const res = await fetch(`https://api.multiavatar.com/${q}.png?apikey=2xi9ve1j34EPd8`)\r\n    if(res.status != 200) throw(new Error())\r\n    else return res.url\r\n}\r\nasync function sendImageToRoom(dataURL: string, messageId: string, room_hash: string, imageIndex): Promise<string | null> {\r\n    const message_url = `rooms/${room_hash}/${messageId}/${imageIndex}`\r\n    return await sendImageToServer(dataURL, message_url)\r\n}\r\nasync function sendImageToServer(dataURL: string, url: string): Promise<string | null> {\r\n    const file = await URLtoFile(dataURL),\r\n          storageReference: StorageReference = ref(storage, url)\r\n    if(file) {\r\n        await uploadBytes(storageReference, file)\r\n        return await getDownloadURL(storageReference)\r\n    }\r\n    else {\r\n        console.warn('Unable to parse dataURL in URLtoFile method in sendImageToServer method of imageUpload ')\r\n        return null\r\n    }\r\n}\r\nexport { getDataURL, getGeneratedAvatar, URLtoFile, onImagePaste, changeImageSize, sendImageToRoom }\r\n\r\nexport interface dataURL {\r\n    dataUrl: string,\r\n    additionalData: string,\r\n    coded: string\r\n}","import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createElementBlock as _createElementBlock } from \"vue\"\n\nconst _hoisted_1 = { class: \"w-full h-full bg-white dark:bg-dark-200 sm:rounded sm:shadow sm:h-auto flex justify-center items-center overflow-y-scroll scrollbar-hide\" }\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_profile_edit = _resolveComponent(\"profile-edit\")!\n\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    (_ctx.user)\n      ? (_openBlock(), _createBlock(_component_profile_edit, {\n          key: 0,\n          user: _ctx.user,\n          onClose: _ctx.redirect\n        }, null, 8, [\"user\", \"onClose\"]))\n      : _createCommentVNode(\"\", true)\n  ]))\n}","<template>\r\n  <form class=\"relative flex flex-col sm:gap-4 gap-2 min-w-[220px] sm:h-auto w-full h-full rounded px-4 py-2 bg-white dark:bg-dark-200\" @submit.prevent=\"onSubmit\">\r\n    <header class=\"flex flex-col gap-2\">\r\n        <div class=\"flex justify-between items-center\">\r\n            <p class=\"font-semibold text-lg text-gray-700 dark:text-gray-300\">{{ $t('titles.profile') }}</p>\r\n            <small class=\"flex items-center gap-4 text-xs text-gray-700 dark:text-gray-300\" v-if=\"loading\">{{$t('form.operations.titles.update')}}<base-loader size=\"small\" /></small>\r\n            <small class=\"flex items-center gap-4 text-xs text-gray-700 dark:text-gray-300\" v-else-if=\"imageLoading\">{{ $t('form.operations.titles.wait') }}<base-loader size=\"small\" /></small>\r\n        </div>\r\n    </header>\r\n    <main class=\"sm:overflow-visible flex flex-col flex-1 sm:gap-4 gap-2\">\r\n        <div class=\"flex sm:flex-row flex-col gap-6 items-center flex-wrap w-full\">\r\n            <div class=\"sm:w-[6rem] w-[12rem] flex flex-col gap-2 text-center items-center mt-6\">\r\n                <div\r\n                ref=\"imageWrapper\"\r\n                @click=\"$refs.fileInput.click()\"\r\n                class=\"flex justify-center items-center w-44 h-44 sm:w-[6rem] sm:h-[6rem] rounded-full bg-gray-200 cursor-pointer transition-all hover:opacity-75 overflow-hidden\" title=\"Загрузка фото\">\r\n                    <img :src=\"form.photoURL\" :alt=\"form.name\" :class=\"imageLoading || !form.photoURL ? 'hidden appearance-none' : 'h-full w-full object-cover'\">\r\n                </div>\r\n                <input\r\n                @change=\"imageUpload\"\r\n                type=\"file\"\r\n                name=\"avatar\"\r\n                ref=\"fileInput\"\r\n                accept=\"image/*\"\r\n                class=\"hidden\" >\r\n                <small class=\"text-xs text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-600 cursor-pointer whitespace-nowrap\" @click=\"imageGenerate\">{{ $t('phrases.randomAvatar') }}</small> \r\n            </div>\r\n            <div class=\"flex min-w-[2rem] flex-col flex-1 justify-center w-full gap-2\">\r\n                <div class=\"flex-4\">\r\n                    <base-input v-model=\"form.name\" :label=\"$t('form.placeholders.username')\" class=\"pb-2\"></base-input>\r\n                    <base-checkbox v-model=\"checked\" class=\"pb-4\">{{$t('phrases.namedAvatar')}}</base-checkbox>\r\n                </div>\r\n                <base-input :value=\"user.email\" :label=\"$t('form.placeholders.email')\" disabled class=\"flex-6\"></base-input>\r\n            </div>\r\n        </div>\r\n        <base-textarea\r\n        class='max-h-full'\r\n        :maxLength=\"256\"\r\n        v-model=\"form.bio\"\r\n        :label=\"$t('form.placeholders.bio')\" />\r\n        <div class=\"grid grid-cols-5 gap-2\">\r\n            <base-button class=\"col-span-3\" type=\"submit\" @click=\"onSubmit\">{{ $t('form.buttons.save') }}</base-button>\r\n            <base-button class=\"col-span-2\" theme=\"passive\" @click=\"close\"> {{ $t('form.buttons.cancel') }} </base-button>\r\n        </div>\r\n    </main>\r\n    <footer class=\"flex flex-col gap-3\">\r\n        <small class=\"text-gray-400 text-xs w-full text-end\">Avatars by Multiavatar.com</small>\r\n    </footer>\r\n</form>\r\n</template>\r\n\r\n<script>\r\nimport _ from \"lodash\"\r\nimport { getDataURL, URLtoFile, getGeneratedAvatar } from '@/utils/imageUpload'\r\nexport default {\r\n    props: {\r\n        user: {\r\n            type: Object,\r\n            required: true\r\n        }\r\n    },\r\n    data() {\r\n        return {\r\n            form: {\r\n                name: '',\r\n                bio: '',\r\n                photoURL: '',\r\n                email: ''\r\n            },\r\n            loading: false,\r\n            checked: false,\r\n            width: 96,\r\n            compressModifier: 100,\r\n            imageLoading: false,\r\n            debouncedAvatarQuery: null\r\n        }\r\n    },\r\n    created() {\r\n        this.form.email = this.user.email\r\n    },\r\n    mounted() {\r\n        if(!this.user) {\r\n            this.$toast.show('Пользователь не найден')\r\n        }\r\n        Object.keys(this.form).forEach((key) => {\r\n            this.form[key] = this.user[key]\r\n        })\r\n    },\r\n    methods: {\r\n        close() {\r\n            this.$emit('close')\r\n        },\r\n        async imageUpload(e) {\r\n            try {\r\n                const inputImage = e.target.files[0]\r\n                this.imageLoading = true\r\n                this.form.photoURL = (await getDataURL(inputImage, 0.9, this.width)).dataUrl \r\n                this.imageLoading = false\r\n            }\r\n            catch {\r\n                this.$toast.show('Что то пошло не так :(')\r\n                this.imageLoading = false\r\n            }\r\n        },\r\n        async imageGenerate() {\r\n            try {\r\n                this.imageLoading = true\r\n                this.form.photoURL = (await getGeneratedAvatar())\r\n            }\r\n            catch(e) {\r\n                console.warn(e)\r\n            } \r\n            this.imageLoading = false\r\n        },\r\n        async onSubmit() {\r\n            this.loading = true\r\n            let profile_body = {...this.form}\r\n            try {\r\n                const file = await URLtoFile(this.form.photoURL)\r\n                profile_body = {\r\n                    ...this.form,\r\n                    profile_photo_file: file\r\n                }\r\n            }\r\n            catch(e) {\r\n                console.warn(e)\r\n            }\r\n            await this.$store.dispatch('auth/updateUserProfile', { ...profile_body })\r\n            await this.$store.dispatch('auth/cacheUser', {\r\n                email: this.user.email,\r\n                uid: this.user.uid,\r\n                name: this.form.name,\r\n                photoURL: this.form.photoURL,\r\n                password: this.user.password,\r\n                bio: this.form.bio\r\n            })\r\n            this.loading = false\r\n            this.$emit('close')\r\n        }\r\n    },\r\n    watch: {\r\n        async \"form.name\"(newVal) {\r\n            if(this.debouncedAvatarQuery) this.debouncedAvatarQuery.cancel() \r\n            if(this.checked) {\r\n                this.imageLoading = true\r\n                this.debouncedAvatarQuery = _.debounce(async function(q){\r\n                    this.form.photoURL = await getGeneratedAvatar(q)\r\n                    this.imageLoading = false\r\n                }, 850).bind(this)(newVal)\r\n            }\r\n        },\r\n        async checked(newVal, oldVal){\r\n            if(!oldVal && newVal && this.form.name) {\r\n                this.imageLoading = true\r\n                this.form.photoURL = await getGeneratedAvatar(this.form.name)\r\n                this.imageLoading = false\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>","import { render } from \"./ProfileEdit.vue?vue&type=template&id=7e62513a\"\nimport script from \"./ProfileEdit.vue?vue&type=script&lang=js\"\nexport * from \"./ProfileEdit.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\User\\\\Desktop\\\\learn\\\\messenger-app\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","\r\nimport User from '@/classes/auth/User'\r\nimport ProfileEdit from '@/components/UI/Auth/ProfileEdit.vue'\r\nimport { defineComponent } from 'vue'\r\nexport default defineComponent({    \r\n    props: {\r\n        uid: {\r\n            type: String,\r\n            required: true\r\n        }\r\n    },\r\n    name: 'ProfileEditPage',\r\n    components: { ProfileEdit },\r\n    data: () => ({ user: null }),\r\n    methods: {\r\n        redirect() {\r\n            if(this.$route.query.fallback)\r\n                this.$router.push({name: this.$route.query.fallback})\r\n            else this.$router.push('/')\r\n        }\r\n    },\r\n    async created() {\r\n        this.user = await this.$store.dispatch('contacts/getUserInfoByUid', this.uid) as User\r\n        console.log(this.user)\r\n        if(!this.uid || !this.user) {\r\n            this.$router.push({name: this.$route.query.fallback || 'login', query: {\r\n                message: 'auth/user-not-found'\r\n            }})\r\n        }\r\n    }\r\n})\r\n","import { render } from \"./ProfileEditPage.vue?vue&type=template&id=68cd3f2b&ts=true\"\nimport script from \"./ProfileEditPage.vue?vue&type=script&lang=ts\"\nexport * from \"./ProfileEditPage.vue?vue&type=script&lang=ts\"\n\nimport exportComponent from \"C:\\\\Users\\\\User\\\\Desktop\\\\learn\\\\messenger-app\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["async","onImagePaste","e","item","clipboardData","originalEvent","items","console","log","kind","blob","getAsFile","getDataURL","inputImage","compress","width","maxHeight","height","Promise","resolve","reader","FileReader","readAsDataURL","onload","event","imageDataUrl","target","result","imageElement","document","createElement","src","width_ratio","canvas","ctx","getContext","drawImage","newImageDataUrl","toDataURL","dataUrl","additionalData","split","coded","URLtoFile","url","includes","blobbed_response","fetch","file","File","type","warn","getGeneratedAvatar","q","i","Math","floor","random","toString","res","status","Error","sendImageToRoom","dataURL","messageId","room_hash","imageIndex","message_url","sendImageToServer","storageReference","ref","storage","uploadBytes","getDownloadURL","_hoisted_1","class","render","_ctx","_cache","$props","$setup","$data","$options","_component_profile_edit","_resolveComponent","_openBlock","_createElementBlock","user","_createBlock","key","onClose","redirect","_createCommentVNode","_createElementVNode","onSubmit","_withModifiers","args","_hoisted_2","_hoisted_3","_toDisplayString","$t","loading","_hoisted_4","_createVNode","_component_base_loader","size","imageLoading","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","onClick","$event","$refs","fileInput","click","title","form","photoURL","alt","name","_normalizeClass","onChange","imageUpload","accept","imageGenerate","_hoisted_10","_hoisted_11","_component_base_input","label","_component_base_checkbox","checked","value","email","disabled","_component_base_textarea","maxLength","bio","_hoisted_12","_component_base_button","theme","close","_hoisted_13","props","Object","required","data","compressModifier","debouncedAvatarQuery","created","this","mounted","$toast","show","keys","forEach","methods","$emit","files","profile_body","profile_photo_file","$store","dispatch","uid","password","watch","newVal","cancel","_","bind","oldVal","__exports__","defineComponent","String","components","ProfileEdit","$route","query","fallback","$router","push","message"],"sourceRoot":""}