"use strict";(self["webpackChunkmessenger_app"]=self["webpackChunkmessenger_app"]||[]).push([[889],{7080:function(e,t,s){s.d(t,{JD:function(){return r},Sf:function(){return i},Zp:function(){return n},nn:function(){return l},xF:function(){return d}});var a=s(1294),o=s(3410);async function n(e){const t=(e.clipboardData||e.originalEvent.clipboardData).items[0];if(console.log((e.clipboardData||e.originalEvent.clipboardData).items),"file"===t.kind){const e=t.getAsFile();return await i(e,1,800,800)}return null}function i(e,t,s,a,o){return new Promise((a=>{const n=new FileReader;n.readAsDataURL(e),n.onload=function(e){const n=e.target.result,i=document.createElement("img");i.src=n,i.onload=function(e){const n=s/e.target.width,r=document.createElement("canvas"),l=r.getContext("2d");r.width=s,r.height=o||e.target.height,r.height*=n,l.drawImage(i,0,0,r.width,r.height);const d=l.canvas.toDataURL("image/jpeg",t);a({dataUrl:d,additionalData:d.split(",")[0],coded:d.split(",")[1]})}}}))}async function r(e){try{if(e.includes("firebasestorage"))return null;const t=await((await fetch(e))?.blob()),s=new File([t],"File",{type:t.type});return s}catch(t){throw console.warn("Failed to fetch an image URL, this may be a CORS"),t}}async function l(e=""){if(!e)for(let s=0;s<6;s++)e+=Math.floor(47*Math.random()).toString();const t=await fetch(`https://api.multiavatar.com/${e}.png?apikey=2xi9ve1j34EPd8`);if(200!=t.status)throw new Error;return t.url}async function d(e,t,s,a){const o=`rooms/${s}/${t}/${a}`;return await c(e,o)}async function c(e,t){const s=await r(e),n=(0,a.iH)(o.tO,t);return s?(await(0,a.KV)(n,s),await(0,a.Jt)(n)):(console.warn("Unable to parse dataURL in URLtoFile method in sendImageToServer method of imageUpload "),null)}},8889:function(e,t,s){s.r(t),s.d(t,{default:function(){return We}});var a=s(3396),o=s(7139);const n={class:"flex flex-col max-h-[100vh] w-full dark:bg-gray-600 relative overflow-hidden"},i={class:"flex flex-col gap-3 items-center space-y-2"},r={class:"w-[calc(32*.25rem)] overflow-hidden bg-gray-100 rounded-full"},l=["src","alt"],d={key:0,class:"overflow-x-hidden"},c={class:"flex gap-5 items-center h-14 dark:bg-dark-200 bg-gray-700 shadow pr-2"},g=(0,a._)("i",{class:"fa-solid fa-angle-left text-xl"},null,-1),u=[g],h={class:"flex items-center justify-center min-h-[2.5rem] min-w-[2.5rem] max-h-[2.5rem] max-w-[2.5rem] bg-gray-300 rounded-full overflow-hidden"},m=["src"],p={key:0,class:"flex-1 overflow-hidden"},f={class:"font-semibold text-ellipsis overflow-hidden w-full dark:text-gray-300 text-gray-300 text-sm"},w={class:"font-semibold text-ellipsis overflow-hidden w-full dark:text-gray-500 text-gray-500 text-xs"},x={key:1,class:"flex items-center h-full pl-4"},y={class:"flex-1"},v={class:"absolute bottom-0 w-full bg-gray-100 dark:bg-gray-700"},b={key:0,class:"flex gap-2 w-full p-2"};function k(e,t,s,g,k,I){const D=(0,a.up)("base-modal"),_=(0,a.up)("base-loader"),M=(0,a.up)("messages-list"),C=(0,a.up)("message-form");return(0,a.wg)(),(0,a.iD)("div",n,[e.contactInfo?((0,a.wg)(),(0,a.j4)(D,{key:0,modelValue:e.showProfile,"onUpdate:modelValue":t[0]||(t[0]=t=>e.showProfile=t)},{header:(0,a.w5)((()=>[(0,a._)("p",null,"Пользователь "+(0,o.zw)(e.contactInfo.name),1)])),default:(0,a.w5)((()=>[(0,a._)("div",i,[(0,a._)("div",r,[e.contactInfo.photoURL?((0,a.wg)(),(0,a.iD)("img",{key:0,src:e.contactInfo.photoURL,alt:e.contactInfo.name,class:"object-fit h-full"},null,8,l)):(0,a.kq)("",!0)]),e.contactInfo.bio?((0,a.wg)(),(0,a.iD)("p",d,"О себе: "+(0,o.zw)(e.contactInfo.bio),1)):(0,a.kq)("",!0)])])),_:1},8,["modelValue"])):(0,a.kq)("",!0),(0,a._)("header",c,[(0,a._)("div",{class:"flex items-center justify-center h-full w-16 cursor-pointer text-gray-600 dark:text-gray-300 hover:text-gray-100 dark:hover:text-gray-100 transition-colors",onClick:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},u),e.loading?((0,a.wg)(),(0,a.iD)("div",x,[(0,a.Wm)(_,{size:"small"})])):((0,a.wg)(),(0,a.iD)("div",{key:0,class:"flex gap-2 items-center h-full cursor-pointer",onClick:t[2]||(t[2]=(...t)=>e.openProfile&&e.openProfile(...t))},[(0,a._)("div",h,[e.contactInfo?.photoURL?((0,a.wg)(),(0,a.iD)("img",{key:0,src:e.contactInfo?.photoURL,alt:"",class:"h-[2.5rem] w-[2.5rem] object-cover"},null,8,m)):(0,a.kq)("",!0)]),e.contactInfo?.name?((0,a.wg)(),(0,a.iD)("div",p,[(0,a._)("p",f,(0,o.zw)(e.contactInfo.name),1),(0,a._)("p",w,(0,o.zw)(e.contactInfo.uid),1)])):(0,a.kq)("",!0)]))]),(0,a._)("main",y,[e.messages?.length?((0,a.wg)(),(0,a.j4)(M,{key:0,onEditMessage:e.onEditMessage,messages:e.messages,uid:e.getUser.uid,roomHash:e.getRoomHash},null,8,["onEditMessage","messages","uid","roomHash"])):(0,a.kq)("",!0),(0,a._)("div",{class:(0,o.C_)(["top-0 left-0 absolute flex flex-col items-center sm:h-full h-[calc(100%)] justify-center gap-4 z-50 w-full bg-[rgba(0,0,0,.4)] transition-all pointer-events-none",e.loading?"":"opacity-0"])},[(0,a.Wm)(_,{size:"big"})],2)]),(0,a._)("footer",v,[e.contactInfo?((0,a.wg)(),(0,a.iD)("div",b,[(0,a.Wm)(C,{class:"self-center",chatPartner:e.contactInfo.name,onNewMessage:e.sendMessage},null,8,["chatPartner","onNewMessage"])])):(0,a.kq)("",!0)])])}s(7658);var I=s(4806),D=s.n(I),_=s(65);const M={class:"flex w-full max-w-full flex-col"},C={key:0,class:"h-36 flex flex-col gap-2 px-[42px]"},S={class:"flex justify-between items-center w-full h-6"},E={key:0,class:"text-xs text-gray-500 flex items-center gap-2"},$={key:1,class:"text-xs text-gray-500"},P=(0,a._)("i",{class:"fa-solid fa-xmark group-hover:opacity-75 text-gray-500 text-lg"},null,-1),j=[P],R={class:"flex items-center gap-2 h-24 max-w-full"},T=["src"],U={class:"flex items-center w-full gap-2 max-w-full"},q={class:"flex w-full flex-col max-w-full h-full"};function N(e,t,s,n,i,r){const l=(0,a.up)("base-loader"),d=(0,a.up)("message-text-input");return(0,a.wg)(),(0,a.iD)("div",M,[e.pinnedImages.length?((0,a.wg)(),(0,a.iD)("div",C,[(0,a._)("div",S,[e.loading?((0,a.wg)(),(0,a.iD)("small",E,[(0,a.Uk)("Отправка... "),(0,a.Wm)(l,{size:"tiny"})])):((0,a.wg)(),(0,a.iD)("small",$,(0,o.zw)(e.pinnedImages.length)+" прикреплённ"+(0,o.zw)(e.pinnedImages.length>1?"ых":"ая")+" картин"+(0,o.zw)(e.pinnedImages.length>1?"ки":"ка"),1)),e.loading?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",{key:2,class:"h-full w-6 cursor-pointer group",onClick:t[0]||(t[0]=(...t)=>e.removePinnedImages&&e.removePinnedImages(...t))},j))]),(0,a._)("div",R,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.pinnedImages,((e,t)=>((0,a.wg)(),(0,a.iD)("img",{class:"object-cover rounded max-h-full flex-1 border-2 sm:max-w-[300px] sm:overflow-hidden max-w-[100px] overflow-x-scroll scrollbar-hide",src:e,key:t},null,8,T)))),128))])])):(0,a.kq)("",!0),(0,a._)("div",U,[(0,a._)("div",q,[(0,a.Wm)(d,{chatPartner:e.chatPartner,placeholder:e.placeholder,"allow-image-paste":e.pinnedImages.length<8,modelValue:e.messageText,"onUpdate:modelValue":t[1]||(t[1]=t=>e.messageText=t),onEnter:e.pushNewMessage,onAddImage:e.addImage,onLoadImage:e.onImageLoad,messageSending:e.loading},null,8,["chatPartner","placeholder","allow-image-paste","modelValue","onEnter","onAddImage","onLoadImage","messageSending"])])])])}var B=s(9242);const F={class:"flex w-full gap-2"},H=(0,a._)("i",{class:"block fa-solid fa-image text-gray-700 group-hover:text-gray-800 dark:text-gray-500 dark:group-hover:text-gray-400 transition-colors"},null,-1),V={class:"rounded-full min-w-[36px] h-[36px] border dark:border-gray-600 flex items-center justify-center cursor-pointer group"},L={class:"sm:text-lg"},z=["placeholder","value"],O={key:0,class:"min-w-[36px] h-[36px] flex items-center justify-center"},Z=(0,a._)("i",{class:"block fa-solid fa-paper-plane text-gray-700 group-hover:text-gray-800 dark:text-gray-500 dark:group-hover:text-gray-400 transition-colors"},null,-1),W=[Z];function A(e,t,s,n,i,r){const l=(0,a.up)("base-emoji"),d=(0,a.up)("base-tooltip"),c=(0,a.up)("base-loader"),g=(0,a.Q2)("tooltip");return(0,a.wg)(),(0,a.iD)("div",F,[(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",{class:"rounded-full min-w-[36px] h-[36px] border dark:border-gray-600 flex items-center justify-center cursor-pointer group",onClick:t[1]||(t[1]=(...t)=>e.onFileClick&&e.onFileClick(...t))},[H,(0,a._)("input",{ref:"input",type:"file",class:"hidden",accept:"image/*",multiple:"",onChange:t[0]||(t[0]=(...t)=>e.onFileLoad&&e.onFileLoad(...t))},null,544)])),[[g,"Файл"]]),(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",V,[(0,a._)("span",L,(0,o.zw)(e.emoji),1),(0,a.Wm)(d,{options:{trigger:"click"}},{default:(0,a.w5)((()=>[(0,a.Wm)(l,{onPushEmoji:e.onEmojiPick},null,8,["onPushEmoji"])])),_:1})])),[[g,"Эмодзи"]]),(0,a._)("textarea",{placeholder:e.placeholder,class:"text-sm sm:text-md rounded-2xl bg-gray-200 dark:bg-gray-800 flex w-full p-2 dark:text-gray-300 text-gray-600 whitespace-wrap overflow-auto outline-none scrollbar-hide resize-none m-0 focus:bg-gray-200 dark:focus:bg-gray-900 transition-colors",ref:"textarea",value:e.modelValue,onFocusin:t[2]||(t[2]=t=>e.focused=!0),onFocusout:t[3]||(t[3]=t=>e.focused=!1),onInput:t[4]||(t[4]=(...t)=>e.onInput&&e.onInput(...t)),onKeydown:[t[5]||(t[5]=(0,B.D2)((0,B.iM)(((...t)=>e.pushEnter&&e.pushEnter(...t)),["shift"]),["enter"])),t[6]||(t[6]=(0,B.D2)((0,B.iM)(((...t)=>e.onEnter&&e.onEnter(...t)),["prevent","exact"]),["enter"]))],onPaste:t[7]||(t[7]=(...t)=>e.onPaste&&e.onPaste(...t))},null,40,z),e.loading||e.messageSending?((0,a.wg)(),(0,a.iD)("div",O,[(0,a.Wm)(c,{size:"small"})])):(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",{key:1,class:"rounded-full min-w-[36px] h-[36px] border dark:border-gray-600 flex items-center justify-center cursor-pointer group",onClick:t[8]||(t[8]=(...t)=>e.onEnter&&e.onEnter(...t))},W)),[[g,"Отправить"]])])}var K=s(6964),G=s(7080),J=(0,a.aZ)({name:"MessageTextInput",data:()=>({emoji:"",textarea:null,height:"",focused:!1,loading:!1}),props:{modelValue:{type:String,required:!1,default:""},maxHeight:{type:Number,required:!1,default:180},minHeight:{type:Number,required:!1,default:32},chatPartner:{type:String,required:!1,default:""},messageSending:{type:Boolean,required:!1,default:!1},allowImagePaste:{type:Boolean,required:!1,default:!0}},mounted(){this.textarea=this.$refs.textarea,this.emoji=this.getRandomEmoji(),this.calculateStyles()},methods:{getRandomEmoji:K.l,onImagePaste:G.Zp,calculateStyles(){const e=e=>e>this.maxHeight?this.maxHeight:e;this.textarea.style.height=this.minHeight+"px"||0,this.textarea.style.height=e(this.textarea.scrollHeight)+"px"},onEmojiPick(e,t){const s=t?this[t]:this.modelValue;this.onInput({target:{value:s+e}},t)},onFileClick(){this.$refs.input.click()},async onFileLoad(e){const t=e.target.files,s=new FileReader,a=[];for(let o=0;o<t.length;o++){const e=t[o];a.push(await new Promise(((t,a)=>{s.onload=e=>{const s=e.target?.result;t(s)},s.onerror=e=>{console.warn(e),a()},s.readAsDataURL(e)})))}this.$emit("loadImage",a)},async onPaste(e){if(!this.allowImagePaste)return void this.$toast.show("Можно добавлять до 8 картинок");const t=await this.onImagePaste(e);if(t){this.loading=!0;const e=document.createElement("img");e.src=t.dataUrl,e.onload=s=>{this.$emit("addImage",t.dataUrl),this.loading=!1,e.onload=null,e.remove()}}},onInput(e,t){this.calculateStyles(),t?this[t]+=e.target.value:this.$emit("update:modelValue",e.target.value)},onEnter(e){this.$emit("enter",this.modelValue),this.$emit("update:modelValue",""),this.$nextTick((()=>{this.calculateStyles()}))},onFocus(){this.focused=!0},pushEnter(){this.modelValue&&(this.$emit("update:modelValue",this.modelValue+"\n"),this.$nextTick((()=>{this.textarea.scrollTop=this.textarea.scrollHeight,this.calculateStyles()})))}},computed:{placeholder(){return this.chatPartner?`Написать ${this.chatPartner}`:"Введите сообщение..."}},watch:{placeholder(){this.emoji=this.getRandomEmoji()}}}),Q=s(89);const Y=(0,Q.Z)(J,[["render",A]]);var X,ee=Y;function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function se(e,t){if("object"!==te(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!==te(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function ae(e){var t=se(e,"string");return"symbol"===te(t)?t:String(t)}function oe(e,t,s){return t=ae(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class ne{constructor(e,t,s,a,o,n,i,r,l){oe(this,"id",void 0),oe(this,"created_at",void 0),oe(this,"sended_at",void 0),oe(this,"sended_by_uid",void 0),oe(this,"sended_by_name",void 0),oe(this,"sended_by_photo_url",void 0),oe(this,"text",void 0),oe(this,"pinnedImages",void 0),oe(this,"readStatus",void 0),this.id=e,this.created_at=t,this.sended_at=s,this.sended_by_uid=a,this.sended_by_name=o,this.sended_by_photo_url=n,this.text=i,this.pinnedImages=r,this.readStatus=l}}(function(e){e[e["SENDING"]=0]="SENDING",e[e["SENDED"]=1]="SENDED",e[e["READ"]=2]="READ"})(X||(X={}));var ie=X,re=(0,a.aZ)({name:"MessageForm",components:{MessageTextInput:ee},props:{chatPartner:{type:String,required:!1,default:""},placeholder:{type:String,required:!1,default:""}},data:()=>({pinnedImages:[],messageText:"",loading:!1}),methods:{onImagePaste:G.Zp,async addImage(e){e&&this.pinnedImages.push(e)},onImageLoad(e){const t=this.pinnedImages.length?this.pinnedImages:[];let s=[...t,...e];s.length>8&&(this.$toast.show("Можно добавлять до 8 картинок"),s=s.slice(0,8)),this.pinnedImages=s},async pushNewMessage(e){if(!e&&!this.pinnedImages.length)return;this.loading=!0;const t=""+Math.random(),s=[];if(0!==this.pinnedImages.length){for(let e=0;e<this.pinnedImages.length;e++){const a=await(0,G.xF)(this.pinnedImages[e],t,this.getRoomHash,e);a&&s.push(a)}for(let e=0;e<s.length;e++)console.log(s[e])}this.$emit("newMessage",new ne(t,new Date,JSON.stringify(new Date),this.getUser.uid,this.getUser.displayName,this.getUser.photoURL,e,s,ie.SENDED)),this.loading=!1,this.pinnedImages=[]},removePinnedImages(){this.pinnedImages=[]}},mounted(){this.imageElement=this.$refs.image},computed:{...(0,_.Se)("auth",["getUser"]),...(0,_.Se)("contacts",["getContacts"]),...(0,_.Se)("room",["getRoomInfo"]),getRoomHash(){return this.getContacts?.find((e=>e.uid===this.$route.params.chatId))?.room_hash},getMessages(){return this.getRoomInfo(this.getRoomHash)?.messages||[]},chatId(){return this.$route.params.chatId}}});const le=(0,Q.Z)(re,[["render",N]]);var de=le;const ce={class:"sm:h-[calc(100vh_-_6.5rem)] h-[calc(100vh_-_11.5rem)] relative"},ge={class:"text-sm text-gray-600 dark:text-gray-400"},ue={class:"flex gap-2 pt-2"},he={class:"absolute top-2 left-1/2 -translate-x-1/2 z-50"},me={class:"flex flex-col gap-2 px-2 py-1 overflow-scroll scrollbar-hide h-full relative",ref:"messages_container"};function pe(e,t,s,n,i,r){const l=(0,a.up)("base-button"),d=(0,a.up)("base-modal"),c=(0,a.up)("base-date-badge"),g=(0,a.up)("base-message"),u=(0,a.Q2)("on-scroll");return(0,a.wg)(),(0,a.iD)("div",ce,[(0,a.Wm)(d,{modelValue:e.showConfirmDialog,"onUpdate:modelValue":t[1]||(t[1]=t=>e.showConfirmDialog=t)},{header:(0,a.w5)((()=>[(0,a.Uk)(" Подтверждение операции")])),default:(0,a.w5)((()=>[(0,a._)("p",ge,"Вы уверены, что хотите "+(0,o.zw)(e.operationName)+" ?",1),(0,a._)("div",ue,[(0,a.Wm)(l,{theme:"alert",onClick:e.deleteMessage},{default:(0,a.w5)((()=>[(0,a.Uk)("Удалить")])),_:1},8,["onClick"]),(0,a.Wm)(l,{theme:"neutral",onClick:t[0]||(t[0]=t=>e.showConfirmDialog=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("Отмена")])),_:1})])])),_:1},8,["modelValue"]),(0,a._)("div",he,[(0,a.Wm)(B.uT,{name:"fade"},{default:(0,a.w5)((()=>[this.showBadge?((0,a.wg)(),(0,a.j4)(c,{key:0,date:new Date},null,8,["date"])):(0,a.kq)("",!0)])),_:1})]),(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",me,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.messages,((t,s)=>((0,a.wg)(),(0,a.j4)(g,{parentElement:e.containter,isCounterMessage:e.isCounterMessage(t.sended_by_uid),message:t,key:e.getMessageKey(t.sended_at),placementOrder:e.getMessagePlacementOrder(s),onView:s=>e.onMessageView(t),onDelete:e.onDeleteMessageClick},null,8,["parentElement","isCounterMessage","message","placementOrder","onView","onDelete"])))),128))])),[[u,{callback:e.showDateBadge}]])])}const fe={class:"flex flex-col w-36 gap-2"},we=(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Редактировать",-1),xe=(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Переслать",-1),ye=(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Сохранить",-1),ve={class:"flex gap-2 items-center h-full self-end overflow-hidden"},be={class:"flex gap-2 items-center overflow-hidden max-w-xl"},ke={class:"flex flex-col gap-2"},Ie={key:0,class:"flex flex-col gap-2 max-h-[360px] w-full"},De=["src"],_e={key:0,class:"flex gap-2 max-w-xl flex-1 h-full"},Me=["src"],Ce={class:"h-full flex items-center justify-end"},Se={key:0,class:"fa-solid fa-check-double text-gray-700 text-xs"},Ee={key:1,class:"fa-solid fa-check text-gray-700 text-xs"},$e={key:2,class:"fa-solid fa-hourglass-half text-gray-700 text-xs"};function Pe(e,t,s,n,i,r){const l=(0,a.up)("base-tooltip"),d=(0,a.Q2)("on-view");return(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["w-full h-auto gap-2 items-center flex group",{"justify-end flex-row":!e.isCounterMessage}])},[(0,a.wy)((0,a._)("small",{class:"text-gray-500 dark:text-gray-300 text-xs will-dissapear group-hover:opacity-100 opacity-0 transition-all"},(0,o.zw)(e.filterDate(e.message.sended_at)),513),[[B.F8,!e.isCounterMessage]]),(0,a._)("div",{onClick:t[1]||(t[1]=t=>e.showTooltip=!0),class:(0,o.C_)(["cursor-pointer rounded-3xl max-w-[calc(100%_-_2rem)] min-h-[1.5rem] h-auto min-w-[4rem] shadow-md inline-flex transition-all px-3 py-2 overflow-hidden",e.getStyles])},[e.showTooltip?((0,a.wg)(),(0,a.j4)(l,{key:0,options:{allowHTML:!0,trigger:"click",followCursor:"initial"}},{default:(0,a.w5)((()=>[(0,a._)("div",fe,[(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors",onClick:t[0]||(t[0]=t=>e.onClick("onDelete",e.message))},"Удалить"),we,xe,ye])])),_:1})):(0,a.kq)("",!0),(0,a._)("div",ve,[(0,a._)("div",be,[(0,a._)("div",ke,[e.message.pinnedImages.length?((0,a.wg)(),(0,a.iD)("div",Ie,[(0,a._)("img",{src:e.message.pinnedImages[0],class:"object-cover rounded-2xl max-h-[320px] w-full"},null,8,De),e.message.pinnedImages?.length>1?((0,a.wg)(),(0,a.iD)("div",_e,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.message.pinnedImages.slice(1),((e,t)=>((0,a.wg)(),(0,a.iD)("div",{class:"flex max-h-[30px] w-full",key:t},[(0,a._)("img",{src:e,class:"object-cover rounded-2xl max-h-[40px] w-full"},null,8,Me)])))),128))])):(0,a.kq)("",!0)])):(0,a.kq)("",!0),(0,a._)("p",{class:(0,o.C_)(["text-sm text-ellipsis px-2 overflow-hidden whitespace-pre",{"text-gray-300":e.isCounterMessage,"text-gray-700":!e.isCounterMessage}])},(0,o.zw)(e.message.text),3)]),(0,a.wy)((0,a._)("div",Ce,["READ"===e.messageStatus?((0,a.wg)(),(0,a.iD)("i",Se)):"SENDED"===e.messageStatus?((0,a.wg)(),(0,a.iD)("i",Ee)):"SENDING"===e.messageStatus?((0,a.wg)(),(0,a.iD)("i",$e)):(0,a.kq)("",!0)],512),[[B.F8,!e.isCounterMessage]])])])],2),(0,a.wy)((0,a._)("small",{class:"text-gray-500 dark:text-gray-300 text-xs will-dissapear group-hover:opacity-100 opacity-0 transition-all"},(0,o.zw)(e.filterDate(e.message.sended_at)),513),[[B.F8,e.isCounterMessage]])],2)),[[d,e.onView]])}var je=s(1727),Re=(0,a.aZ)({data:()=>({showTooltip:!0}),name:"BaseMessage",props:{message:{type:Object,required:!0},isCounterMessage:{type:Boolean,required:!0,default:!0},placementOrder:{type:String,required:!1,default:"middle"},parentElement:{type:HTMLElement,required:!1}},methods:{onView(){this.isCounterMessage&&2!==this.message.readStatus&&this.$emit("view")},filterDate(e){return(0,je.n)(e)},onClick(e,t){this[e]?.(t),this.showTooltip=!1},onDelete(e){this.$emit("delete",e.id)}},computed:{getBorderStyles(){return"middle"===this.placementOrder?"":this.isCounterMessage?"first"===this.placementOrder?"message-first-counter":"message-last-counter":this.isCounterMessage?"":"first"===this.placementOrder?"message-first":"message-last"},getStyles(){const e=this.isCounterMessage;return this.getBorderStyles+" "+(e?"bg-gray-900":"bg-blue-300")},messageStatus(){return 2===this.message.readStatus?"READ":1===this.message.readStatus?"SENDED":0===this.message.readStatus?"SENDING":""}}});const Te=(0,Q.Z)(Re,[["render",Pe]]);var Ue=Te;const qe={class:"bg-[rgba(0,0,0,.8)] rounded-full text-gray-300 font-semibold py-1 px-2 transtion-colors max-h-8 pointer-events-none"};function Ne(e,t,s,n,i,r){return(0,a.wg)(),(0,a.iD)("div",qe,[(0,a._)("small",null,(0,o.zw)(e.filteredDate),1)])}var Be=(0,a.aZ)({name:"BaseDateBadge",props:{date:{type:Object,required:!0,default:new Date}},computed:{filteredDate(){const e=Intl.DateTimeFormat("Ru-ru",{day:"numeric",weekday:"long",month:"long"}).format(this.date)+"";return e[0].toUpperCase()+e.slice(1,e.length)}}});const Fe=(0,Q.Z)(Be,[["render",Ne]]);var He=Fe,Ve=(0,a.aZ)({name:"MessagesList",components:{BaseMessage:Ue,BaseDateBadge:He},mounted(){this.scrollToBottom()},data:()=>({containter:null,loading:!1,showBadgeTimeout:null,showBadge:!1,showConfirmDialog:!1,operationName:"",chosenMessageId:""}),props:{uid:{type:String,required:!0,default:""},messages:{type:Array,required:!0,default:()=>[]},roomHash:{type:Number,required:!0}},methods:{async onMessageView(e){await this.$store.dispatch("room/updateMessage",{hash:this.roomHash,id:e.id,updateFields:{readStatus:ie.READ}})},showDateBadge(){clearTimeout(this.showBadgeTimeout),this.showBadge=!0,this.showBadgeTimeout=setTimeout((()=>{this.showBadge=!1,clearTimeout(this.showBadgeTimeout)}),2e3)},scrollToBottom(e){function t(){"smooth"===e?this.container.scrollTo({top:this.container.scrollHeight,behavior:"smooth"}):this.container.scrollTop=this.container.scrollHeight}this.container=this.$refs.messages_container,this.$nextTick(t)},getMessageKey(e){return+new Date(JSON.parse(e))},getMessagePlacementOrder(e){return e===this.messages.length-1?"last":0===e?"first":"middle"},isCounterMessage(e){return e!=this.uid},async deleteMessage(){this.showConfirmDialog=!0,this.$store.dispatch("room/deleteMessage",{id:this.chosenMessageId,counterId:this.$route.params.chatId}),this.$toast.show("Сообщение было удалено"),this.showConfirmDialog=!1},async onDeleteMessageClick(e){this.showConfirmDialog=!0,this.operationName="удалить сообщение",this.chosenMessageId=e}},watch:{messages:{handler(e){this.scrollToBottom("smooth")},deep:!0},"$route.params.chatId"(){this.showDateBadge()}}});const Le=(0,Q.Z)(Ve,[["render",pe]]);var ze=Le,Oe=(0,a.aZ)({name:"ChatLayout",components:{MessageForm:de,MessagesList:ze},data:()=>({contactInfo:null,messagesContainer:null,messages:[],loading:!1,showProfile:!1,newMessageText:""}),methods:{close(){this.$router.push({name:"main"})},openProfile(){this.showProfile=!0},async getContactInfo(){const e=this.$route.params.chatId;let t=this.getContacts.find((t=>t.uid===e));return t||(t=await this.$store.dispatch("contacts/getUserInfoByUid",this.$route.params.chatId)),t},async sendMessage(e){if(e)try{this.messages.push(e),await this.$store.dispatch("room/sendMessageToUser",{message:e,counterId:this.contactInfo.uid})}catch(t){console.warn(t)}},onEditMessage(e){this.editableMessage=e}},watch:{"$route.params.chatId":{async handler(e){this.messages=[],e&&(this.loading=!0,this.contactInfo=await this.getContactInfo(),this.messages=D().cloneDeep(this.getMessages),this.loading=!1,this.contactInfo||"chat"!==this.$route.name||this.$router.push({name:"main"}).then((()=>{this.$toast.error("Пользователь не найден")})))},immediate:!0},getMessages:{handler(e){this.messages=D().cloneDeep(e)},deep:!0}},computed:{...(0,_.Se)("auth",["getUser"]),...(0,_.Se)("contacts",["getContacts"]),...(0,_.Se)("room",["getRoomInfo"]),getRoomHash(){return this.getContacts?.find((e=>e.uid===this.$route.params.chatId))?.room_hash},getMessages(){return this.getRoomInfo(this.getRoomHash)?.messages||[]},chatId(){return this.$route.params.chatId}}});const Ze=(0,Q.Z)(Oe,[["render",k]]);var We=Ze}}]);
//# sourceMappingURL=889.ef63632f.js.map