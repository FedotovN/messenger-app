"use strict";(self["webpackChunkmessenger_app"]=self["webpackChunkmessenger_app"]||[]).push([[905],{1905:function(e,t,s){s.r(t),s.d(t,{default:function(){return oe}});var a=s(3396),r=s(7139);const n={class:"flex flex-col max-h-[100vh] w-full bg-gray-100 dark:bg-gray-600 relative"},i={key:0,class:"overflow-x-hidden"},o={key:1},l={key:2},c={class:"flex gap-5 items-center min-h-[4rem] dark:bg-dark-200 bg-gray-700 shadow px-2"},d=(0,a._)("i",{class:"fa-solid fa-angle-left text-3xl"},null,-1),u=[d],h={class:"flex items-center justify-center min-h-[3rem] min-w-[3rem] max-h-[3rem] max-w-[3rem] bg-gray-300 rounded-full overflow-hidden"},m=["src"],g={key:0,class:"flex-1 overflow-hidden"},f={class:"font-semibold text-ellipsis overflow-hidden w-full dark:text-gray-300 text-gray-300"},p={key:1,class:"flex items-center h-full pl-4"},y={class:"sm:h-[calc(100vh_-_8rem)] h-[calc(100vh_-_10.25rem)] relative"},x={class:"absolute top-2 left-1/2 -translate-x-1/2 z-50"},w={class:"flex flex-col gap-2 px-2 py-1 overflow-scroll scrollbar-hide h-full relative",ref:"messages_container"},v={class:"min-h-[4rem] absolute bottom-0 w-full"},b={key:0,class:"w-full h-full"};function _(e,t,s,d,_,D){const k=(0,a.up)("base-modal"),S=(0,a.up)("base-loader"),I=(0,a.up)("base-date-badge"),C=(0,a.up)("base-message"),M=(0,a.up)("base-chat-input");return(0,a.wg)(),(0,a.iD)("div",n,[e.contactInfo?((0,a.wg)(),(0,a.j4)(k,{key:0,modelValue:e.showProfile,"onUpdate:modelValue":t[0]||(t[0]=t=>e.showProfile=t)},{header:(0,a.w5)((()=>[(0,a.Uk)(" Пользователь "+(0,r.zw)(e.contactInfo.name),1)])),default:(0,a.w5)((()=>[e.contactInfo.bio?((0,a.wg)(),(0,a.iD)("p",i,"О себе: "+(0,r.zw)(e.contactInfo.bio),1)):((0,a.wg)(),(0,a.iD)("p",o,"Решил не рассказывать о себе ничего!")),e.contactInfo.email?((0,a.wg)(),(0,a.iD)("p",l,"Почта: "+(0,r.zw)(e.contactInfo.email),1)):(0,a.kq)("",!0)])),_:1},8,["modelValue"])):(0,a.kq)("",!0),(0,a._)("header",c,[(0,a._)("div",{class:"flex items-center h-full px-3 cursor-pointer text-gray-600 dark:text-gray-300 hover:text-gray-100 dark:hover:text-gray-100 transition-colors",onClick:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},u),e.loading?((0,a.wg)(),(0,a.iD)("div",p,[(0,a.Wm)(S,{size:"small"})])):((0,a.wg)(),(0,a.iD)("div",{key:0,class:"flex gap-2 items-center h-full cursor-pointer",onClick:t[2]||(t[2]=(...t)=>e.openProfile&&e.openProfile(...t))},[(0,a._)("div",h,[e.contactInfo.photoURL?((0,a.wg)(),(0,a.iD)("img",{key:0,src:e.contactInfo.photoURL,alt:"",class:"h-full w-full object-cover"},null,8,m)):(0,a.kq)("",!0)]),e.contactInfo.name?((0,a.wg)(),(0,a.iD)("div",g,[(0,a._)("p",f,(0,r.zw)(e.contactInfo.name),1)])):(0,a.kq)("",!0)]))]),(0,a._)("main",y,[(0,a._)("div",x,[(0,a.Wm)(I,{date:new Date},null,8,["date"])]),(0,a._)("div",w,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.messages,((t,s)=>((0,a.wg)(),(0,a.j4)(C,{isCounterMessage:t.sended_by_uid!=e.getUser.uid,message:t,key:e.getMessageKey(t.sended_at),placementOrder:e.getMessagePlacementOrder(s)},null,8,["isCounterMessage","message","placementOrder"])))),128))],512),(0,a._)("div",{class:(0,r.C_)(["top-0 left-0 absolute flex flex-col items-center sm:h-full h-[calc(100%_-_1rem)] justify-center gap-4 z-50 w-full bg-[rgba(0,0,0,.4)] transition-all pointer-events-none",e.loading?"":"opacity-0"])},[(0,a.Wm)(S,{size:"big"})],2)]),(0,a._)("footer",v,[e.contactInfo?((0,a.wg)(),(0,a.iD)("div",b,[(0,a.Wm)(M,{modelValue:e.newMessageText,"onUpdate:modelValue":t[3]||(t[3]=t=>e.newMessageText=t),chatPartner:e.contactInfo.name,onEnter:e.print,class:""},null,8,["modelValue","chatPartner","onEnter"])])):(0,a.kq)("",!0)])])}s(7658);var D=s(65);const k={class:"flex gap-2 items-center h-full self-end"},S={class:"flex flex-col gap-1"},I={class:"flex justify-between items-center px-2"},C={class:"flex gap-2 pr-2 items-center"},M=(0,a._)("small",{class:"text-gray-500 text-xs"},"Отправлено",-1),$=(0,a._)("div",{class:"h-1 w-1 bg-gray-500 rounded-full"},null,-1),E={class:"text-gray-500 text-xs"},P=(0,a._)("div",{class:"h-1 w-1 bg-gray-500 rounded-full mr-2"},null,-1),O=(0,a._)("div",{class:"text-gray-600 text-xs"},"Изменено",-1);function H(e,t,s,n,i,o){return(0,a.wg)(),(0,a.iD)("div",{class:(0,r.C_)(["w-full h-auto flex",{"justify-end":!e.isCounterMessage}])},[(0,a._)("div",{class:(0,r.C_)(["cursor-pointer rounded-3xl max-w-[calc(100%_-_2rem)] min-h-[1.5rem] h-auto min-w-[4rem] shadow-md inline-flex transition-all p-3",e.getStyles])},[(0,a._)("div",k,[(0,a._)("div",S,[(0,a._)("p",{class:(0,r.C_)(["text-sm text-ellipsis px-2 -mt-1",{"text-gray-300":e.isCounterMessage,"text-gray-700":!e.isCounterMessage}])},(0,r.zw)(e.message.content),3),(0,a._)("div",I,[(0,a._)("div",C,[M,$,(0,a._)("small",E,(0,r.zw)(e.filterDate(e.message.sended_at)),1)]),P,O])])])],2)],2)}var U=(0,a.aZ)({name:"BaseMessage",props:{message:{type:Object,required:!0},isCounterMessage:{type:Boolean,required:!0,default:!0},placementOrder:{type:String,required:!1,default:"middle"}},methods:{filterDate(e){const t=new Date(JSON.parse(e));return Intl.DateTimeFormat("Ru-ru",{hour:"2-digit",minute:"2-digit"}).format(t)}},computed:{getBorderStyles(){return"middle"===this.placementOrder?"":this.isCounterMessage?"first"===this.placementOrder?"message-first-counter":"message-last-counter":this.isCounterMessage?"":"first"===this.placementOrder?"message-first":"message-last"},getStyles(){const e=this.isCounterMessage;return this.getBorderStyles+" "+(e?"bg-gray-900":"bg-blue-300")}},data:()=>({})}),B=s(89);const N=(0,B.Z)(U,[["render",H]]);var T,j=N;(function(e){e[e["SENDING"]=0]="SENDING",e[e["SENDED"]=1]="SENDED",e[e["READ"]=2]="READ"})(T||(T={}));var q=T;function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function z(e,t){if("object"!==V(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!==V(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function R(e){var t=z(e,"string");return"symbol"===V(t)?t:String(t)}function Z(e,t,s){return t=R(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class L{constructor(e,t,s,a,r,n,i,o){Z(this,"created_at",void 0),Z(this,"sended_at",void 0),Z(this,"sended_by_uid",void 0),Z(this,"sended_by_name",void 0),Z(this,"sended_by_photo_url",void 0),Z(this,"content",void 0),Z(this,"readStatus",void 0),Z(this,"isOverwritten",void 0),this.created_at=e,this.sended_at=t,this.sended_by_uid=s,this.sended_by_name=a,this.sended_by_photo_url=r,this.content=n,this.readStatus=i,this.isOverwritten=o}}var F=s(9242);const K={class:"flex flex-col max-w-full"},W=(0,a._)("p",null,"Shift + enter - Перенос строки",-1),J=[W],A=["placeholder","value"];function G(e,t,s,n,i,o){return(0,a.wg)(),(0,a.iD)("div",K,[(0,a._)("div",{class:(0,r.C_)(["sm:flex hidden px-2 gap-10 justify-end text-xs text-gray-500 dark:text-gray-500 transition-all",{"opacity-0":e.focused}])},J,2),(0,a._)("textarea",{placeholder:e.placeholder,class:"flex w-full p-2 dark:text-gray-300 text-gray-600 whitespace-wrap overflow-auto bg-gray-200 dark:bg-gray-700 sm:bg-transparent outline-none scrollbar-hide resize-none m-0 focus:bg-gray-200 dark:focus:bg-gray-700 transition-colors",ref:"textarea",value:e.modelValue,onFocusin:t[0]||(t[0]=t=>e.focused=!0),onFocusout:t[1]||(t[1]=t=>e.focused=!1),onInput:t[2]||(t[2]=(...t)=>e.onInput&&e.onInput(...t)),onKeydown:[t[3]||(t[3]=(0,F.D2)((0,F.iM)(((...t)=>e.pushEnter&&e.pushEnter(...t)),["shift"]),["enter"])),t[4]||(t[4]=(0,F.D2)((0,F.iM)(((...t)=>e.onEnter&&e.onEnter(...t)),["prevent","exact"]),["enter"]))]},null,40,A)])}var Y=(0,a.aZ)({name:"BaseChatInput",props:{modelValue:{type:String,required:!1,default:""},maxHeight:{type:Number,required:!1,default:180},minHeight:{type:Number,required:!1,default:64},chatPartner:{type:String,required:!1,default:""}},data:()=>({textarea:null,height:"",focused:!1}),methods:{calculateStyles(){const e=e=>e>this.maxHeight?this.maxHeight:e;this.textarea.style.height=this.minHeight+"px"||0,this.textarea.style.height=e(this.textarea.scrollHeight)+"px"},onInput(e){this.calculateStyles(),this.$emit("update:modelValue",e.target.value)},onEnter(e){this.$emit("enter",e.target.value),this.$emit("update:modelValue",""),this.$nextTick((()=>{this.calculateStyles()}))},onFocus(){this.focused=!0},pushEnter(){this.modelValue&&(this.$emit("update:modelValue",this.modelValue+"\n"),this.$nextTick((()=>{this.textarea.scrollTop=this.textarea.scrollHeight,this.calculateStyles()})))}},mounted(){this.textarea=this.$refs.textarea,this.calculateStyles()},computed:{placeholder(){return this.chatPartner?`Написать ${this.chatPartner}`:"Введите сообщение..."}}});const Q=(0,B.Z)(Y,[["render",G]]);var X=Q;const ee={class:"bg-[rgba(0,0,0,.8)] rounded-full text-gray-300 font-semibold py-1 px-2 transtion-colors max-h-8 pointer-events-none"};function te(e,t,s,n,i,o){return(0,a.wg)(),(0,a.iD)("div",ee,[(0,a._)("small",null,(0,r.zw)(e.filteredDate),1)])}var se=(0,a.aZ)({name:"BaseDateBadge",props:{date:{type:Object,required:!0,default:new Date}},computed:{filteredDate(){const e=Intl.DateTimeFormat("Ru-ru",{day:"numeric",weekday:"long",month:"long"}).format(this.date)+"";return e[0].toUpperCase()+e.slice(1,e.length)}}});const ae=(0,B.Z)(se,[["render",te]]);var re=ae,ne=(0,a.aZ)({name:"ChatLayout",components:{BaseChatInput:X,BaseMessage:j,BaseDateBadge:re},data:()=>({contactInfo:null,messagesContainer:null,loading:!0,showProfile:!1,newMessageText:"",messages:[]}),methods:{close(){this.$router.push({name:"main"})},openProfile(){this.showProfile=!0},print(e){const t=this.$refs.messages_container;this.sendMessage(e),this.$nextTick((()=>{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})}))},async sendMessage(e){if(!e)return;const t=new L(new Date,JSON.stringify(new Date),this.getUser.uid,this.getUser.displayName,this.getUser.photoURL,e,q.SENDED,!1);this.messages.push(t),await this.$store.dispatch("chat/sendMessageToUser",{message:t,counterId:this.contactInfo.uid}),this.messages=await this.$store.dispatch("chat/getMessagesListByRoomHash",this.getRoomHash)},getMessageKey(e){return+new Date(JSON.parse(e))},getMessagePlacementOrder(e){return e===this.messages.length-1?"last":0===e?"first":"middle"}},watch:{"$route.params.chatId":{async handler(){this.$route.params.chatId&&(this.loading=!0,this.contactInfo=await this.$store.dispatch("contacts/getUserInfoByUid",this.$route.params.chatId),this.messages=await this.$store.dispatch("chat/getMessagesListByRoomHash",this.getRoomHash),this.container=this.$refs.messages_container,this.$nextTick((()=>{this.container.scrollTop=this.container.scrollHeight})),this.contactInfo||"chat"!==this.$route.name||this.$toast.error("Пользователь не найден"),this.loading=!1)},immediate:!0}},computed:{...(0,D.Se)("auth",["getUser"]),...(0,D.Se)("contacts",["getContacts"]),getRoomHash(){return this.getContacts?.find((e=>e.uid===this.$route.params.chatId))?.room_hash}}});const ie=(0,B.Z)(ne,[["render",_]]);var oe=ie}}]);
//# sourceMappingURL=905.923ba8f8.js.map