"use strict";(self["webpackChunkmessenger_app"]=self["webpackChunkmessenger_app"]||[]).push([[981],{9981:function(e,t,s){s.r(t),s.d(t,{default:function(){return ie}});var a=s(3396),r=s(7139);const o={class:"flex flex-col max-h-[100vh] w-full bg-gray-100 dark:bg-gray-600 relative"},n={key:0,class:"overflow-x-hidden"},i={key:1},l={key:2},c={class:"flex gap-5 items-center min-h-[4.35rem] dark:bg-dark-200 bg-gray-700 shadow pr-2"},u=(0,a._)("i",{class:"fa-solid fa-angle-left text-xl"},null,-1),d=[u],h={class:"flex items-center justify-center min-h-[3rem] min-w-[3rem] max-h-[3rem] max-w-[3rem] bg-gray-300 rounded-full overflow-hidden"},g=["src"],m={key:0,class:"flex-1 overflow-hidden"},f={class:"font-semibold text-ellipsis overflow-hidden w-full dark:text-gray-300 text-gray-300"},p={key:1,class:"flex items-center h-full pl-4"},y={class:"flex-1"},w={class:"min-h-[4rem] absolute bottom-0 w-full"},x={key:0,class:"w-full h-full"};function v(e,t,s,u,v,b){const _=(0,a.up)("base-modal"),k=(0,a.up)("base-loader"),D=(0,a.up)("messages-list"),I=(0,a.up)("base-chat-input");return(0,a.wg)(),(0,a.iD)("div",o,[e.contactInfo?((0,a.wg)(),(0,a.j4)(_,{key:0,modelValue:e.showProfile,"onUpdate:modelValue":t[0]||(t[0]=t=>e.showProfile=t)},{header:(0,a.w5)((()=>[(0,a.Uk)(" Пользователь "+(0,r.zw)(e.contactInfo.name),1)])),default:(0,a.w5)((()=>[e.contactInfo.bio?((0,a.wg)(),(0,a.iD)("p",n,"О себе: "+(0,r.zw)(e.contactInfo.bio),1)):((0,a.wg)(),(0,a.iD)("p",i,"Решил не рассказывать о себе ничего!")),e.contactInfo.email?((0,a.wg)(),(0,a.iD)("p",l,"Почта: "+(0,r.zw)(e.contactInfo.email),1)):(0,a.kq)("",!0)])),_:1},8,["modelValue"])):(0,a.kq)("",!0),(0,a._)("header",c,[(0,a._)("div",{class:"flex items-center justify-center h-full w-16 cursor-pointer text-gray-600 dark:text-gray-300 hover:text-gray-100 dark:hover:text-gray-100 transition-colors",onClick:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},d),e.loading?((0,a.wg)(),(0,a.iD)("div",p,[(0,a.Wm)(k,{size:"small"})])):((0,a.wg)(),(0,a.iD)("div",{key:0,class:"flex gap-2 items-center h-full cursor-pointer",onClick:t[2]||(t[2]=(...t)=>e.openProfile&&e.openProfile(...t))},[(0,a._)("div",h,[e.contactInfo?.photoURL?((0,a.wg)(),(0,a.iD)("img",{key:0,src:e.contactInfo?.photoURL,alt:"",class:"h-full w-full object-cover"},null,8,g)):(0,a.kq)("",!0)]),e.contactInfo?.name?((0,a.wg)(),(0,a.iD)("div",m,[(0,a._)("p",f,(0,r.zw)(e.contactInfo.name),1)])):(0,a.kq)("",!0)]))]),(0,a._)("main",y,[e.messages?.length?((0,a.wg)(),(0,a.j4)(D,{key:0,messages:e.messages,uid:e.getUser.uid},null,8,["messages","uid"])):(0,a.kq)("",!0),(0,a._)("div",{class:(0,r.C_)(["top-0 left-0 absolute flex flex-col items-center sm:h-full h-[calc(100%_-_1rem)] justify-center gap-4 z-50 w-full bg-[rgba(0,0,0,.4)] transition-all pointer-events-none",e.loading?"":"opacity-0"])},[(0,a.Wm)(k,{size:"big"})],2)]),(0,a._)("footer",w,[e.contactInfo?((0,a.wg)(),(0,a.iD)("div",x,[(0,a.Wm)(I,{modelValue:e.newMessageText,"onUpdate:modelValue":t[3]||(t[3]=t=>e.newMessageText=t),chatPartner:e.contactInfo.name,onEnter:e.print,class:""},null,8,["modelValue","chatPartner","onEnter"])])):(0,a.kq)("",!0)])])}s(7658);var b=s(4806),_=s.n(b),k=s(65);function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}function I(e,t){if("object"!==D(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!==D(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function C(e){var t=I(e,"string");return"symbol"===D(t)?t:String(t)}function M(e,t,s){return t=C(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class S{constructor(e,t,s,a,r,o){M(this,"created_at",void 0),M(this,"sended_at",void 0),M(this,"sended_by_uid",void 0),M(this,"sended_by_name",void 0),M(this,"sended_by_photo_url",void 0),M(this,"content",void 0),this.created_at=e,this.sended_at=t,this.sended_by_uid=s,this.sended_by_name=a,this.sended_by_photo_url=r,this.content=o}}var B=s(9242);const T={class:"flex flex-col max-w-full"},$=(0,a._)("p",null,"Shift + enter - Перенос строки",-1),q=[$],P=["placeholder","value"];function j(e,t,s,o,n,i){return(0,a.wg)(),(0,a.iD)("div",T,[(0,a._)("div",{class:(0,r.C_)(["sm:flex hidden px-2 gap-10 justify-end text-xs text-gray-500 dark:text-gray-500 transition-all",{"opacity-0":e.focused}])},q,2),(0,a._)("textarea",{placeholder:e.placeholder,class:"flex w-full p-2 dark:text-gray-300 text-gray-600 whitespace-wrap overflow-auto bg-gray-200 dark:bg-gray-700 sm:bg-transparent outline-none scrollbar-hide resize-none m-0 focus:bg-gray-200 dark:focus:bg-gray-700 transition-colors",ref:"textarea",value:e.modelValue,onFocusin:t[0]||(t[0]=t=>e.focused=!0),onFocusout:t[1]||(t[1]=t=>e.focused=!1),onInput:t[2]||(t[2]=(...t)=>e.onInput&&e.onInput(...t)),onKeydown:[t[3]||(t[3]=(0,B.D2)((0,B.iM)(((...t)=>e.pushEnter&&e.pushEnter(...t)),["shift"]),["enter"])),t[4]||(t[4]=(0,B.D2)((0,B.iM)(((...t)=>e.onEnter&&e.onEnter(...t)),["prevent","exact"]),["enter"]))]},null,40,P)])}var U=(0,a.aZ)({name:"BaseChatInput",props:{modelValue:{type:String,required:!1,default:""},maxHeight:{type:Number,required:!1,default:180},minHeight:{type:Number,required:!1,default:64},chatPartner:{type:String,required:!1,default:""}},data:()=>({textarea:null,height:"",focused:!1}),methods:{calculateStyles(){const e=e=>e>this.maxHeight?this.maxHeight:e;this.textarea.style.height=this.minHeight+"px"||0,this.textarea.style.height=e(this.textarea.scrollHeight)+"px"},onInput(e){this.calculateStyles(),this.$emit("update:modelValue",e.target.value)},onEnter(e){this.$emit("enter",e.target.value),this.$emit("update:modelValue",""),this.$nextTick((()=>{this.calculateStyles()}))},onFocus(){this.focused=!0},pushEnter(){this.modelValue&&(this.$emit("update:modelValue",this.modelValue+"\n"),this.$nextTick((()=>{this.textarea.scrollTop=this.textarea.scrollHeight,this.calculateStyles()})))}},mounted(){this.textarea=this.$refs.textarea,this.calculateStyles()},computed:{placeholder(){return this.chatPartner?`Написать ${this.chatPartner}`:"Введите сообщение..."}}}),O=s(89);const z=(0,O.Z)(U,[["render",j]]);var H=z;const V={class:"sm:h-[calc(100vh_-_8rem)] h-[calc(100vh_-_10.5rem)] relative"},Z={class:"absolute top-2 left-1/2 -translate-x-1/2 z-50"},E={class:"flex flex-col gap-2 px-2 py-1 overflow-scroll scrollbar-hide h-full relative",ref:"messages_container"};function R(e,t,s,r,o,n){const i=(0,a.up)("base-date-badge"),l=(0,a.up)("base-message"),c=(0,a.Q2)("on-scroll");return(0,a.wg)(),(0,a.iD)("div",V,[(0,a._)("div",Z,[(0,a.Wm)(B.uT,{name:"fade"},{default:(0,a.w5)((()=>[this.showBadge?((0,a.wg)(),(0,a.j4)(i,{key:0,date:new Date},null,8,["date"])):(0,a.kq)("",!0)])),_:1})]),(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",E,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.messages,((t,s)=>((0,a.wg)(),(0,a.j4)(l,{isCounterMessage:e.isCounterMessage(t.sended_by_uid),message:t,key:e.getMessageKey(t.sended_at),placementOrder:e.getMessagePlacementOrder(s)},null,8,["isCounterMessage","message","placementOrder"])))),128))])),[[c,{callback:e.showDateBadge}]])])}const F=(0,a._)("div",{class:"flex flex-col w-32 gap-2"},[(0,a._)("div",{class:"flex justify-between items-center h-6 w-full rounded-md"},[(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"}),(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"}),(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"}),(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"}),(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"})]),(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Удалить"),(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Редактировать"),(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Переслать"),(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Сохранить")],-1),L={class:"flex gap-2 items-center h-full self-end overflow-hidden"},N={class:"flex flex-col overflow-hidden"};function W(e,t,s,o,n,i){const l=(0,a.up)("base-tooltip");return(0,a.wg)(),(0,a.iD)("div",{class:(0,r.C_)(["w-full h-auto gap-2 items-center flex group",{"justify-end flex-row":!e.isCounterMessage}])},[(0,a.wy)((0,a._)("small",{class:"text-gray-500 dark:text-gray-300 text-xs will-dissapear group-hover:opacity-100 opacity-0 transition-all"},(0,r.zw)(e.filterDate(e.message.sended_at)),513),[[B.F8,!e.isCounterMessage]]),(0,a._)("div",{class:(0,r.C_)(["cursor-pointer rounded-3xl max-w-[calc(100%_-_2rem)] min-h-[1.5rem] h-auto min-w-[4rem] shadow-md inline-flex transition-all px-3 py-2 overflow-hidden",e.getStyles])},[(0,a.Wm)(l,{options:{allowHTML:!0,trigger:"click",followCursor:!0}},{default:(0,a.w5)((()=>[F])),_:1}),(0,a._)("div",L,[(0,a._)("div",N,[(0,a._)("p",{class:(0,r.C_)(["text-sm text-ellipsis px-2 overflow-hidden",{"text-gray-300":e.isCounterMessage,"text-gray-700":!e.isCounterMessage}])},(0,r.zw)(e.message.content),3)])])],2),(0,a.wy)((0,a._)("small",{class:"text-gray-500 dark:text-gray-300 text-xs will-dissapear group-hover:opacity-100 opacity-0 transition-all"},(0,r.zw)(e.filterDate(e.message.sended_at)),513),[[B.F8,e.isCounterMessage]])],2)}function K(e,t){const s=new Date(JSON.parse(e)),a={hour:"2-digit",minute:"2-digit"};return Intl.DateTimeFormat("Ru-ru",{...a,...t}).format(s)}var J=(0,a.aZ)({name:"BaseMessage",props:{message:{type:Object,required:!0},isCounterMessage:{type:Boolean,required:!0,default:!0},placementOrder:{type:String,required:!1,default:"middle"}},methods:{filterDate(e){return K(e)}},computed:{getBorderStyles(){return"middle"===this.placementOrder?"":this.isCounterMessage?"first"===this.placementOrder?"message-first-counter":"message-last-counter":this.isCounterMessage?"":"first"===this.placementOrder?"message-first":"message-last"},getStyles(){const e=this.isCounterMessage;return this.getBorderStyles+" "+(e?"bg-gray-900":"bg-blue-300")}}});const A=(0,O.Z)(J,[["render",W]]);var Q=A;const Y={class:"bg-[rgba(0,0,0,.8)] rounded-full text-gray-300 font-semibold py-1 px-2 transtion-colors max-h-8 pointer-events-none"};function G(e,t,s,o,n,i){return(0,a.wg)(),(0,a.iD)("div",Y,[(0,a._)("small",null,(0,r.zw)(e.filteredDate),1)])}var X=(0,a.aZ)({name:"BaseDateBadge",props:{date:{type:Object,required:!0,default:new Date}},computed:{filteredDate(){const e=Intl.DateTimeFormat("Ru-ru",{day:"numeric",weekday:"long",month:"long"}).format(this.date)+"";return e[0].toUpperCase()+e.slice(1,e.length)}}});const ee=(0,O.Z)(X,[["render",G]]);var te=ee,se=(0,a.aZ)({name:"MessagesList",components:{BaseMessage:Q,BaseDateBadge:te},mounted(){this.scrollToBottom()},data:()=>({containter:null,loading:!1,showBadgeTimeout:null,showBadge:!1}),props:{uid:{type:String,required:!0,default:""},messages:{type:Array,required:!0,default:()=>[]}},methods:{showDateBadge(){clearTimeout(this.showBadgeTimeout),this.showBadge=!0,this.showBadgeTimeout=setTimeout((()=>{this.showBadge=!1,clearTimeout(this.showBadgeTimeout)}),2e3)},scrollToBottom(e){function t(){"smooth"===e?this.container.scrollTo({top:this.container.scrollHeight,behavior:"smooth"}):this.container.scrollTop=this.container.scrollHeight}this.container=this.$refs.messages_container,this.$nextTick(t)},getMessageKey(e){return+new Date(JSON.parse(e))},getMessagePlacementOrder(e){return e===this.messages.length-1?"last":0===e?"first":"middle"},isCounterMessage(e){return e!=this.uid}},watch:{messages:{handler(e){console.log(e),e[e.length-1]?.sended_by_uid===this.uid&&this.scrollToBottom("smooth")},deep:!0},"$route.params.chatId"(){this.showDateBadge()}}});const ae=(0,O.Z)(se,[["render",R]]);var re=ae,oe=(0,a.aZ)({name:"ChatLayout",components:{BaseChatInput:H,MessagesList:re},data:()=>({contactInfo:null,messagesContainer:null,messages:[],loading:!1,showProfile:!1,newMessageText:""}),methods:{close(){this.$router.push({name:"main"})},openProfile(){this.showProfile=!0},print(e){this.messagesContainer=this.$refs.messages_container,this.sendMessage(e)},async sendMessage(e){if(!e)return;const t=new S(new Date,JSON.stringify(new Date),this.getUser.uid,this.getUser.displayName,this.getUser.photoURL,e);this.messages.push(t),await this.$store.dispatch("room/sendMessageToUser",{message:t,counterId:this.contactInfo.uid})},async getContactInfo(){const e=this.$route.params.chatId;let t=this.getContacts.find((t=>t.uid===e));return t||(t=await this.$store.dispatch("contacts/getUserInfoByUid",this.$route.params.chatId)),t}},watch:{"$route.params.chatId":{async handler(e){this.messages=[],e&&(this.loading=!0,this.contactInfo=await this.getContactInfo(),this.messages=_().cloneDeep(this.getMessages),this.loading=!1,this.contactInfo||"chat"!==this.$route.name||this.$router.push({name:"main"}).then((()=>{this.$toast.error("Пользователь не найден")})))},immediate:!0},getMessages:{handler(e){this.messages=_().cloneDeep(e)},deep:!0}},computed:{...(0,k.Se)("auth",["getUser"]),...(0,k.Se)("contacts",["getContacts"]),...(0,k.Se)("room",["getRoomInfo"]),getRoomHash(){return this.getContacts?.find((e=>e.uid===this.$route.params.chatId))?.room_hash},getMessages(){return this.getRoomInfo(this.getRoomHash)?.messages||[]}}});const ne=(0,O.Z)(oe,[["render",v]]);var ie=ne}}]);
//# sourceMappingURL=981.e2443587.js.map