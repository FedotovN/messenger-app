"use strict";(self["webpackChunkmessenger_app"]=self["webpackChunkmessenger_app"]||[]).push([[858],{7080:function(e,t,a){a.d(t,{JD:function(){return l},Sf:function(){return r},Zp:function(){return o},nn:function(){return n},xF:function(){return c}});var s=a(1294),i=a(3410);async function o(e){const t=(e.clipboardData||e.originalEvent.clipboardData).items[0];if(console.log((e.clipboardData||e.originalEvent.clipboardData).items),"file"===t.kind){const e=t.getAsFile();return await r(e,1,800,800)}return null}function r(e,t,a,s,i){return new Promise((s=>{const o=new FileReader;o.readAsDataURL(e),o.onload=function(e){const o=e.target.result,r=document.createElement("img");r.src=o,r.onload=function(e){const o=a/e.target.width,l=document.createElement("canvas"),n=l.getContext("2d");l.width=a,l.height=i||e.target.height,l.height*=o,n.drawImage(r,0,0,l.width,l.height);const c=n.canvas.toDataURL("image/jpeg",t);s({dataUrl:c,additionalData:c.split(",")[0],coded:c.split(",")[1]})}}}))}async function l(e){try{if(e.includes("firebasestorage"))return null;const t=await((await fetch(e))?.blob()),a=new File([t],"File",{type:t.type});return a}catch(t){throw console.warn("Failed to fetch an image URL, this may be a CORS"),t}}async function n(e=""){if(!e)for(let a=0;a<6;a++)e+=Math.floor(47*Math.random()).toString();const t=await fetch(`https://api.multiavatar.com/${e}.png?apikey=2xi9ve1j34EPd8`);if(200!=t.status)throw new Error;return t.url}async function c(e,t,a,s){const i=`rooms/${a}/${t}/${s}`;return await u(e,i)}async function u(e,t){const a=await l(e),o=(0,s.iH)(i.tO,t);return a?(await(0,s.KV)(o,a),await(0,s.Jt)(o)):(console.warn("Unable to parse dataURL in URLtoFile method in sendImageToServer method of imageUpload "),null)}},2858:function(e,t,a){a.r(t),a.d(t,{default:function(){return j}});var s=a(3396);const i={class:"w-full h-full bg-white dark:bg-dark-200 sm:rounded sm:shadow sm:h-auto flex justify-center items-center overflow-y-scroll scrollbar-hide"};function o(e,t,a,o,r,l){const n=(0,s.up)("profile-edit");return(0,s.wg)(),(0,s.iD)("div",i,[e.user?((0,s.wg)(),(0,s.j4)(n,{key:0,user:e.user,onClose:e.redirect},null,8,["user","onClose"])):(0,s.kq)("",!0)])}a(7658);var r=a(9242),l=a(7139);const n={class:"flex flex-col gap-2"},c={class:"flex justify-between items-center"},u={class:"font-semibold text-lg text-gray-700 dark:text-gray-300"},m={key:0,class:"flex items-center gap-4 text-xs text-gray-700 dark:text-gray-300"},d={key:1,class:"flex items-center gap-4 text-xs text-gray-700 dark:text-gray-300"},h={class:"sm:overflow-visible flex flex-col flex-1 sm:gap-4 gap-2"},f={class:"flex sm:flex-row flex-col gap-6 items-center flex-wrap w-full"},p={class:"sm:w-[6rem] w-[12rem] flex flex-col gap-2 text-center items-center mt-6"},g=["src","alt"],w={class:"flex min-w-[2rem] flex-col flex-1 justify-center w-full gap-2"},b={class:"flex-4"},x={class:"grid grid-cols-5 gap-2"},y=(0,s._)("footer",{class:"flex flex-col gap-3"},[(0,s._)("small",{class:"text-gray-400 text-xs w-full text-end"},"Avatars by Multiavatar.com")],-1);function v(e,t,a,i,o,v){const k=(0,s.up)("base-loader"),U=(0,s.up)("base-input"),L=(0,s.up)("base-checkbox"),$=(0,s.up)("base-textarea"),_=(0,s.up)("base-button");return(0,s.wg)(),(0,s.iD)("form",{class:"relative flex flex-col sm:gap-4 gap-2 min-w-[220px] sm:h-auto w-full h-full rounded px-4 py-2 bg-white dark:bg-dark-200",onSubmit:t[6]||(t[6]=(0,r.iM)(((...e)=>v.onSubmit&&v.onSubmit(...e)),["prevent"]))},[(0,s._)("header",n,[(0,s._)("div",c,[(0,s._)("p",u,(0,l.zw)(e.$t("titles.profile")),1),o.loading?((0,s.wg)(),(0,s.iD)("small",m,[(0,s.Uk)((0,l.zw)(e.$t("form.operations.titles.update")),1),(0,s.Wm)(k,{size:"small"})])):o.imageLoading?((0,s.wg)(),(0,s.iD)("small",d,[(0,s.Uk)((0,l.zw)(e.$t("form.operations.titles.wait")),1),(0,s.Wm)(k,{size:"small"})])):(0,s.kq)("",!0)])]),(0,s._)("main",h,[(0,s._)("div",f,[(0,s._)("div",p,[(0,s._)("div",{ref:"imageWrapper",onClick:t[0]||(t[0]=t=>e.$refs.fileInput.click()),class:"flex justify-center items-center w-44 h-44 sm:w-[6rem] sm:h-[6rem] rounded-full bg-gray-200 cursor-pointer transition-all hover:opacity-75 overflow-hidden",title:"Загрузка фото"},[(0,s._)("img",{src:o.form.photoURL,alt:o.form.name,class:(0,l.C_)(o.imageLoading||!o.form.photoURL?"hidden appearance-none":"h-full w-full object-cover")},null,10,g)],512),(0,s._)("input",{onChange:t[1]||(t[1]=(...e)=>v.imageUpload&&v.imageUpload(...e)),type:"file",name:"avatar",ref:"fileInput",accept:"image/*",class:"hidden"},null,544),(0,s._)("small",{class:"text-xs text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-600 cursor-pointer whitespace-nowrap",onClick:t[2]||(t[2]=(...e)=>v.imageGenerate&&v.imageGenerate(...e))},(0,l.zw)(e.$t("phrases.randomAvatar")),1)]),(0,s._)("div",w,[(0,s._)("div",b,[(0,s.Wm)(U,{modelValue:o.form.name,"onUpdate:modelValue":t[3]||(t[3]=e=>o.form.name=e),label:e.$t("form.placeholders.username"),class:"pb-2"},null,8,["modelValue","label"]),(0,s.Wm)(L,{modelValue:o.checked,"onUpdate:modelValue":t[4]||(t[4]=e=>o.checked=e),class:"pb-4"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.$t("phrases.namedAvatar")),1)])),_:1},8,["modelValue"])]),(0,s.Wm)(U,{value:a.user.email,label:e.$t("form.placeholders.email"),disabled:"",class:"flex-6"},null,8,["value","label"])])]),(0,s.Wm)($,{class:"max-h-full",maxLength:256,modelValue:o.form.bio,"onUpdate:modelValue":t[5]||(t[5]=e=>o.form.bio=e),label:e.$t("form.placeholders.bio")},null,8,["modelValue","label"]),(0,s._)("div",x,[(0,s.Wm)(_,{class:"col-span-3",type:"submit",onClick:v.onSubmit},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.$t("form.buttons.save")),1)])),_:1},8,["onClick"]),(0,s.Wm)(_,{class:"col-span-2",theme:"passive",onClick:v.close},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.$t("form.buttons.cancel")),1)])),_:1},8,["onClick"])])]),y],32)}var k=a(4806),U=a.n(k),L=a(7080),$={props:{user:{type:Object,required:!0}},data(){return{form:{name:"",bio:"",photoURL:"",email:""},loading:!1,checked:!1,width:96,compressModifier:100,imageLoading:!1,debouncedAvatarQuery:null}},created(){this.form.email=this.user.email},mounted(){this.user||this.$toast.show("Пользователь не найден"),Object.keys(this.form).forEach((e=>{this.form[e]=this.user[e]}))},methods:{close(){this.$emit("close")},async imageUpload(e){try{const t=e.target.files[0];this.imageLoading=!0,this.form.photoURL=(await(0,L.Sf)(t,.9,this.width)).dataUrl,this.imageLoading=!1}catch{this.$toast.show("Что то пошло не так :("),this.imageLoading=!1}},async imageGenerate(){try{this.imageLoading=!0,this.form.photoURL=await(0,L.nn)()}catch(e){console.warn(e)}this.imageLoading=!1},async onSubmit(){this.loading=!0;let e={...this.form};try{const t=await(0,L.JD)(this.form.photoURL);e={...this.form,profile_photo_file:t}}catch(t){console.warn(t)}await this.$store.dispatch("auth/updateUserProfile",{...e}),await this.$store.dispatch("auth/cacheUser",{email:this.user.email,uid:this.user.uid,name:this.form.name,photoURL:this.form.photoURL,password:this.user.password,bio:this.form.bio}),this.loading=!1,this.$emit("close")}},watch:{async"form.name"(e){this.debouncedAvatarQuery&&this.debouncedAvatarQuery.cancel(),this.checked&&(this.imageLoading=!0,this.debouncedAvatarQuery=U().debounce((async function(e){this.form.photoURL=await(0,L.nn)(e),this.imageLoading=!1}),850).bind(this)(e))},async checked(e,t){!t&&e&&this.form.name&&(this.imageLoading=!0,this.form.photoURL=await(0,L.nn)(this.form.name),this.imageLoading=!1)}}},_=a(89);const R=(0,_.Z)($,[["render",v]]);var C=R,D=(0,s.aZ)({props:{uid:{type:String,required:!0}},name:"ProfileEditPage",components:{ProfileEdit:C},data:()=>({user:null}),methods:{redirect(){this.$route.query.fallback?this.$router.push({name:this.$route.query.fallback}):this.$router.push("/")}},async created(){this.user=await this.$store.dispatch("contacts/getUserInfoByUid",this.uid),console.log(this.user),this.uid&&this.user||this.$router.push({name:this.$route.query.fallback||"login",query:{message:"auth/user-not-found"}})}});const S=(0,_.Z)(D,[["render",o]]);var j=S}}]);
//# sourceMappingURL=858.3794053f.js.map