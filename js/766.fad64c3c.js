"use strict";(self["webpackChunkmessenger_app"]=self["webpackChunkmessenger_app"]||[]).push([[766],{9766:function(e,t,s){s.r(t),s.d(t,{default:function(){return ye}});var a=s(3396),o=s(7139);const r={class:"flex flex-col max-h-[100vh] w-full bg-gray-100 dark:bg-gray-600 relative"},i={key:0,class:"overflow-x-hidden"},n={key:1},l={key:2},c={class:"flex gap-5 items-center h-14 dark:bg-dark-200 bg-gray-700 shadow pr-2"},d=(0,a._)("i",{class:"fa-solid fa-angle-left text-xl"},null,-1),u=[d],h={class:"flex items-center justify-center min-h-[2.5rem] min-w-[2.5rem] max-h-[2.5rem] max-w-[2.5rem] bg-gray-300 rounded-full overflow-hidden"},g=["src"],m={key:0,class:"flex-1 overflow-hidden"},f={class:"font-semibold text-ellipsis overflow-hidden w-full dark:text-gray-300 text-gray-300 text-sm"},p={class:"font-semibold text-ellipsis overflow-hidden w-full dark:text-gray-500 text-gray-500 text-xs"},y={key:1,class:"flex items-center h-full pl-4"},w={class:"flex-1"},x={class:"absolute bottom-0 w-full"},v={key:0,class:"w-full h-full"};function b(e,t,s,d,b,_){const D=(0,a.up)("base-modal"),k=(0,a.up)("base-loader"),C=(0,a.up)("messages-list"),I=(0,a.up)("base-chat-input");return(0,a.wg)(),(0,a.iD)("div",r,[e.contactInfo?((0,a.wg)(),(0,a.j4)(D,{key:0,modelValue:e.showProfile,"onUpdate:modelValue":t[0]||(t[0]=t=>e.showProfile=t)},{header:(0,a.w5)((()=>[(0,a.Uk)(" Пользователь "+(0,o.zw)(e.contactInfo.name),1)])),default:(0,a.w5)((()=>[e.contactInfo.bio?((0,a.wg)(),(0,a.iD)("p",i,"О себе: "+(0,o.zw)(e.contactInfo.bio),1)):((0,a.wg)(),(0,a.iD)("p",n,"Решил не рассказывать о себе ничего!")),e.contactInfo.email?((0,a.wg)(),(0,a.iD)("p",l,"Почта: "+(0,o.zw)(e.contactInfo.email),1)):(0,a.kq)("",!0)])),_:1},8,["modelValue"])):(0,a.kq)("",!0),(0,a._)("header",c,[(0,a._)("div",{class:"flex items-center justify-center h-full w-16 cursor-pointer text-gray-600 dark:text-gray-300 hover:text-gray-100 dark:hover:text-gray-100 transition-colors",onClick:t[1]||(t[1]=(...t)=>e.close&&e.close(...t))},u),e.loading?((0,a.wg)(),(0,a.iD)("div",y,[(0,a.Wm)(k,{size:"small"})])):((0,a.wg)(),(0,a.iD)("div",{key:0,class:"flex gap-2 items-center h-full cursor-pointer",onClick:t[2]||(t[2]=(...t)=>e.openProfile&&e.openProfile(...t))},[(0,a._)("div",h,[e.contactInfo?.photoURL?((0,a.wg)(),(0,a.iD)("img",{key:0,src:e.contactInfo?.photoURL,alt:"",class:"h-[2.5rem] w-[2.5rem] object-cover"},null,8,g)):(0,a.kq)("",!0)]),e.contactInfo?.name?((0,a.wg)(),(0,a.iD)("div",m,[(0,a._)("p",f,(0,o.zw)(e.contactInfo.name),1),(0,a._)("p",p,(0,o.zw)(e.contactInfo.uid),1)])):(0,a.kq)("",!0)]))]),(0,a._)("main",w,[e.messages?.length?((0,a.wg)(),(0,a.j4)(C,{key:0,messages:e.messages,uid:e.getUser.uid},null,8,["messages","uid"])):(0,a.kq)("",!0),(0,a._)("div",{class:(0,o.C_)(["top-0 left-0 absolute flex flex-col items-center sm:h-full h-[calc(100%)] justify-center gap-4 z-50 w-full bg-[rgba(0,0,0,.4)] transition-all pointer-events-none",e.loading?"":"opacity-0"])},[(0,a.Wm)(k,{size:"big"})],2)]),(0,a._)("footer",x,[e.contactInfo?((0,a.wg)(),(0,a.iD)("div",v,[(0,a.Wm)(I,{modelValue:e.newMessageText,"onUpdate:modelValue":t[3]||(t[3]=t=>e.newMessageText=t),chatPartner:e.contactInfo.name,onEnter:e.print,class:""},null,8,["modelValue","chatPartner","onEnter"])])):(0,a.kq)("",!0)])])}s(7658);var _=s(4806),D=s.n(_),k=s(65),C=s(3978);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function M(e,t){if("object"!==I(e)||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var a=s.call(e,t||"default");if("object"!==I(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function S(e){var t=M(e,"string");return"symbol"===I(t)?t:String(t)}function B(e,t,s){return t=S(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class ${constructor(e,t,s,a,o,r,i,n){B(this,"id",void 0),B(this,"created_at",void 0),B(this,"sended_at",void 0),B(this,"sended_by_uid",void 0),B(this,"sended_by_name",void 0),B(this,"sended_by_photo_url",void 0),B(this,"content",void 0),B(this,"read_status",void 0),this.id=e,this.created_at=t,this.sended_at=s,this.sended_by_uid=a,this.sended_by_name=o,this.sended_by_photo_url=r,this.content=i,this.read_status=n}}var T=s(9242);const E={class:"flex flex-col max-w-full"},N=["placeholder","value"];function U(e,t,s,o,r,i){return(0,a.wg)(),(0,a.iD)("div",E,[(0,a._)("textarea",{placeholder:e.placeholder,class:"flex w-full p-2 dark:text-gray-300 text-gray-600 whitespace-wrap overflow-auto bg-gray-200 dark:bg-gray-700 sm:bg-transparent outline-none scrollbar-hide resize-none m-0 focus:bg-gray-200 dark:focus:bg-gray-700 transition-colors",ref:"textarea",value:e.modelValue,onFocusin:t[0]||(t[0]=t=>e.focused=!0),onFocusout:t[1]||(t[1]=t=>e.focused=!1),onInput:t[2]||(t[2]=(...t)=>e.onInput&&e.onInput(...t)),onKeydown:[t[3]||(t[3]=(0,T.D2)((0,T.iM)(((...t)=>e.pushEnter&&e.pushEnter(...t)),["shift"]),["enter"])),t[4]||(t[4]=(0,T.D2)((0,T.iM)(((...t)=>e.onEnter&&e.onEnter(...t)),["prevent","exact"]),["enter"]))]},null,40,N)])}var q=(0,a.aZ)({name:"BaseChatInput",props:{modelValue:{type:String,required:!1,default:""},maxHeight:{type:Number,required:!1,default:180},minHeight:{type:Number,required:!1,default:64},chatPartner:{type:String,required:!1,default:""}},data:()=>({textarea:null,height:"",focused:!1}),methods:{calculateStyles(){const e=e=>e>this.maxHeight?this.maxHeight:e;this.textarea.style.height=this.minHeight+"px"||0,this.textarea.style.height=e(this.textarea.scrollHeight)+"px"},onInput(e){this.calculateStyles(),this.$emit("update:modelValue",e.target.value)},onEnter(e){this.$emit("enter",e.target.value),this.$emit("update:modelValue",""),this.$nextTick((()=>{this.calculateStyles()}))},onFocus(){this.focused=!0},pushEnter(){this.modelValue&&(this.$emit("update:modelValue",this.modelValue+"\n"),this.$nextTick((()=>{this.textarea.scrollTop=this.textarea.scrollHeight,this.calculateStyles()})))}},mounted(){this.textarea=this.$refs.textarea,this.calculateStyles()},computed:{placeholder(){return this.chatPartner?`Написать ${this.chatPartner}`:"Введите сообщение..."}}}),P=s(89);const V=(0,P.Z)(q,[["render",U]]);var j=V;const z={class:"sm:h-[calc(100vh_-_6.5rem)] h-[calc(100vh_-_11.5rem)] relative"},Z={class:"text-sm text-gray-600 dark:text-gray-400"},H={class:"flex gap-2 pt-2"},O={class:"absolute top-2 left-1/2 -translate-x-1/2 z-50"},R={class:"flex flex-col gap-2 px-2 py-1 overflow-scroll scrollbar-hide h-full relative",ref:"messages_container"};function W(e,t,s,r,i,n){const l=(0,a.up)("base-button"),c=(0,a.up)("base-modal"),d=(0,a.up)("base-date-badge"),u=(0,a.up)("base-message"),h=(0,a.Q2)("on-scroll");return(0,a.wg)(),(0,a.iD)("div",z,[(0,a.Wm)(c,{modelValue:e.showConfirmDialog,"onUpdate:modelValue":t[1]||(t[1]=t=>e.showConfirmDialog=t)},{header:(0,a.w5)((()=>[(0,a.Uk)(" Подтверждение операции")])),default:(0,a.w5)((()=>[(0,a._)("p",Z,"Вы уверены, что хотите "+(0,o.zw)(e.operationName)+" ?",1),(0,a._)("div",H,[(0,a.Wm)(l,{class:"flex-1",theme:"alert",onClick:e.deleteMessage},{default:(0,a.w5)((()=>[(0,a.Uk)("Удалить")])),_:1},8,["onClick"]),(0,a.Wm)(l,{class:"flex-2",theme:"passive",onClick:t[0]||(t[0]=t=>e.showConfirmDialog=!1)},{default:(0,a.w5)((()=>[(0,a.Uk)("Отмена")])),_:1})])])),_:1},8,["modelValue"]),(0,a._)("div",O,[(0,a.Wm)(T.uT,{name:"fade"},{default:(0,a.w5)((()=>[this.showBadge?((0,a.wg)(),(0,a.j4)(d,{key:0,date:new Date},null,8,["date"])):(0,a.kq)("",!0)])),_:1})]),(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",R,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.messages,((t,s)=>((0,a.wg)(),(0,a.j4)(u,{isCounterMessage:e.isCounterMessage(t.sended_by_uid),message:t,key:e.getMessageKey(t.sended_at),placementOrder:e.getMessagePlacementOrder(s),onDelete:e.onDeleteMessageClick},null,8,["isCounterMessage","message","placementOrder","onDelete"])))),128))])),[[h,{callback:e.showDateBadge}]])])}const F={class:"flex flex-col w-32 gap-2"},L=(0,a._)("div",{class:"flex justify-between items-center h-6 w-full rounded-md"},[(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"}),(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"}),(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"}),(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"}),(0,a._)("div",{class:"w-4 h-4 rounded-full hover:bg-gray-800 bg-gray-950 transition-colors cursor-pointer"})],-1),A=(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Редактировать",-1),G=(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Переслать",-1),K=(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors"},"Сохранить",-1),J={class:"flex gap-2 items-center h-full self-end overflow-hidden"},Q={class:"flex gap-2 overflow-hidden items-center"},Y={class:"flex items-center"},X={key:0,class:"fa-solid fa-check-double text-gray-700 text-xs"},ee={key:1,class:"fa-solid fa-check text-gray-700 text-xs"},te={key:2,class:"fa-solid fa-hourglass-half text-gray-700 text-xs"};function se(e,t,s,r,i,n){const l=(0,a.up)("base-tooltip");return(0,a.wg)(),(0,a.iD)("div",{class:(0,o.C_)(["w-full h-auto gap-2 items-center flex group",{"justify-end flex-row":!e.isCounterMessage}])},[(0,a.wy)((0,a._)("small",{class:"text-gray-500 dark:text-gray-300 text-xs will-dissapear group-hover:opacity-100 opacity-0 transition-all"},(0,o.zw)(e.filterDate(e.message.sended_at)),513),[[T.F8,!e.isCounterMessage]]),(0,a._)("div",{class:(0,o.C_)(["cursor-pointer rounded-3xl max-w-[calc(100%_-_2rem)] min-h-[1.5rem] h-auto min-w-[4rem] shadow-md inline-flex transition-all px-3 py-2 overflow-hidden",e.getStyles])},[(0,a.Wm)(l,{options:{allowHTML:!0,trigger:"click",followCursor:!0}},{default:(0,a.w5)((()=>[(0,a._)("div",F,[L,(0,a._)("p",{class:"text-xs text-blue-300 cursor-pointer hover:text-blue-400 transition-colors",onClick:t[0]||(t[0]=t=>e.$emit("delete",e.message.id))},"Удалить"),A,G,K])])),_:1}),(0,a._)("div",J,[(0,a._)("div",Q,[(0,a._)("p",{class:(0,o.C_)(["text-sm text-ellipsis px-2 overflow-hidden",{"text-gray-300":e.isCounterMessage,"text-gray-700":!e.isCounterMessage}])},(0,o.zw)(e.message.content),3),(0,a.wy)((0,a._)("div",Y,["READ"===e.messageStatus?((0,a.wg)(),(0,a.iD)("i",X)):"SENDED"===e.messageStatus?((0,a.wg)(),(0,a.iD)("i",ee)):"SENDING"===e.messageStatus?((0,a.wg)(),(0,a.iD)("i",te)):(0,a.kq)("",!0)],512),[[T.F8,!e.isCounterMessage]])])])],2),(0,a.wy)((0,a._)("small",{class:"text-gray-500 dark:text-gray-300 text-xs will-dissapear group-hover:opacity-100 opacity-0 transition-all"},(0,o.zw)(e.filterDate(e.message.sended_at)),513),[[T.F8,e.isCounterMessage]])],2)}var ae=s(1727),oe=(0,a.aZ)({name:"BaseMessage",props:{message:{type:Object,required:!0},isCounterMessage:{type:Boolean,required:!0,default:!0},placementOrder:{type:String,required:!1,default:"middle"}},methods:{filterDate(e){return(0,ae.n)(e)}},computed:{getBorderStyles(){return"middle"===this.placementOrder?"":this.isCounterMessage?"first"===this.placementOrder?"message-first-counter":"message-last-counter":this.isCounterMessage?"":"first"===this.placementOrder?"message-first":"message-last"},getStyles(){const e=this.isCounterMessage;return this.getBorderStyles+" "+(e?"bg-gray-900":"bg-blue-300")},messageStatus(){return this.message.read_status===C.Z.READ?"READ":this.message.read_status===C.Z.SENDED?"SENDED":this.message.read_status===C.Z.SENDING?"SENDING":""}}});const re=(0,P.Z)(oe,[["render",se]]);var ie=re;const ne={class:"bg-[rgba(0,0,0,.8)] rounded-full text-gray-300 font-semibold py-1 px-2 transtion-colors max-h-8 pointer-events-none"};function le(e,t,s,r,i,n){return(0,a.wg)(),(0,a.iD)("div",ne,[(0,a._)("small",null,(0,o.zw)(e.filteredDate),1)])}var ce=(0,a.aZ)({name:"BaseDateBadge",props:{date:{type:Object,required:!0,default:new Date}},computed:{filteredDate(){const e=Intl.DateTimeFormat("Ru-ru",{day:"numeric",weekday:"long",month:"long"}).format(this.date)+"";return e[0].toUpperCase()+e.slice(1,e.length)}}});const de=(0,P.Z)(ce,[["render",le]]);var ue=de,he=(0,a.aZ)({name:"MessagesList",components:{BaseMessage:ie,BaseDateBadge:ue},mounted(){this.scrollToBottom()},data:()=>({containter:null,loading:!1,showBadgeTimeout:null,showBadge:!1,showConfirmDialog:!1,operationName:"",chosenMessageId:""}),props:{uid:{type:String,required:!0,default:""},messages:{type:Array,required:!0,default:()=>[]}},methods:{showDateBadge(){clearTimeout(this.showBadgeTimeout),this.showBadge=!0,this.showBadgeTimeout=setTimeout((()=>{this.showBadge=!1,clearTimeout(this.showBadgeTimeout)}),2e3)},scrollToBottom(e){function t(){"smooth"===e?this.container.scrollTo({top:this.container.scrollHeight,behavior:"smooth"}):this.container.scrollTop=this.container.scrollHeight}this.container=this.$refs.messages_container,this.$nextTick(t)},getMessageKey(e){return+new Date(JSON.parse(e))},getMessagePlacementOrder(e){return e===this.messages.length-1?"last":0===e?"first":"middle"},isCounterMessage(e){return e!=this.uid},async deleteMessage(){this.showConfirmDialog=!0,this.$store.dispatch("room/deleteMessage",{id:this.chosenMessageId,counterId:this.$route.params.chatId}),this.$toast.show("Сообщение было удалено"),this.showConfirmDialog=!1},async onDeleteMessageClick(e){this.showConfirmDialog=!0,this.operationName="удалить сообщение",this.chosenMessageId=e}},watch:{messages:{handler(e){e[e.length-1]?.sended_by_uid===this.uid&&this.scrollToBottom("smooth")},deep:!0},"$route.params.chatId"(){this.showDateBadge()}}});const ge=(0,P.Z)(he,[["render",W]]);var me=ge,fe=(0,a.aZ)({name:"ChatLayout",components:{BaseChatInput:j,MessagesList:me},data:()=>({contactInfo:null,messagesContainer:null,messages:[],loading:!1,showProfile:!1,newMessageText:""}),methods:{close(){this.$router.push({name:"main"})},openProfile(){this.showProfile=!0},print(e){this.messagesContainer=this.$refs.messages_container,this.sendMessage(e)},async sendMessage(e){if(!e)return;const t=Math.random()+"",s=new $(t,new Date,JSON.stringify(new Date),this.getUser.uid,this.getUser.displayName,this.getUser.photoURL,e,C.Z.SENDING);this.messages.push(s),await this.$store.dispatch("room/sendMessageToUser",{message:s,counterId:this.contactInfo.uid})},async getContactInfo(){const e=this.$route.params.chatId;let t=this.getContacts.find((t=>t.uid===e));return t||(t=await this.$store.dispatch("contacts/getUserInfoByUid",this.$route.params.chatId)),t}},watch:{"$route.params.chatId":{async handler(e){this.messages=[],e&&(this.loading=!0,this.contactInfo=await this.getContactInfo(),this.messages=D().cloneDeep(this.getMessages),this.loading=!1,this.contactInfo||"chat"!==this.$route.name||this.$router.push({name:"main"}).then((()=>{this.$toast.error("Пользователь не найден")})))},immediate:!0},getMessages:{handler(e){this.messages=D().cloneDeep(e)},deep:!0}},computed:{...(0,k.Se)("auth",["getUser"]),...(0,k.Se)("contacts",["getContacts"]),...(0,k.Se)("room",["getRoomInfo"]),getRoomHash(){return this.getContacts?.find((e=>e.uid===this.$route.params.chatId))?.room_hash},getMessages(){return this.getRoomInfo(this.getRoomHash)?.messages||[]}}});const pe=(0,P.Z)(fe,[["render",b]]);var ye=pe}}]);
//# sourceMappingURL=766.fad64c3c.js.map